"use strict";window.elFinder=function(node,opts){this.time("load");var self=this,node=$(node),prevContent=$("<div/>").append(node.contents()),prevStyle=node.attr("style"),id=node.attr("id")||"",namespace="elfinder-"+(id||Math.random().toString().substr(2,7)),mousedown="mousedown."+namespace,keydown="keydown."+namespace,keypress="keypress."+namespace,enabled=true,prevEnabled=true,events=["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop"],rules={},cwd="",cwdOptions={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:true,tmb:false},files={},selected=[],listeners={},shortcuts={},clipboard=[],remember=[],queue=[],netDrivers=[],base=new self.command(self),width="auto",height=400,beeper=$(document.createElement("audio")).hide().appendTo("body")[0],syncInterval,open=function(data){if(data.init){files={};}else{for(var i in files){if(files.hasOwnProperty(i)&&files[i].mime!="directory"&&files[i].phash==cwd&&$.inArray(i,remember)===-1){delete files[i];}}}cwd=data.cwd.hash;cache(data.files);if(!files[cwd]){cache([data.cwd]);}self.lastDir(cwd);},cache=function(data){var l=data.length,f;while(l--){f=data[l];if(f.name&&f.hash&&f.mime){if(!f.phash){var name="volume_"+f.name,i18=self.i18n(name);if(name!=i18){f.i18=i18;}}files[f.hash]=f;}}},execShortcut=function(e){var code=e.keyCode,ctrlKey=!!(e.ctrlKey||e.metaKey);if(enabled){$.each(shortcuts,function(i,shortcut){if(shortcut.type==e.type&&shortcut.keyCode==code&&shortcut.shiftKey==e.shiftKey&&shortcut.ctrlKey==ctrlKey&&shortcut.altKey==e.altKey){e.preventDefault();e.stopPropagation();shortcut.callback(e,self);self.debug("shortcut-exec",i+" : "+shortcut.description);}});if(code==9&&!$(e.target).is(":input")){e.preventDefault();}}},date=new Date(),utc,i18n;this.api=null;this.newAPI=false;this.oldAPI=false;this.OS=navigator.userAgent.indexOf("Mac")!==-1?"mac":navigator.userAgent.indexOf("Win")!==-1?"win":"other";this.UA=(function(){var webkit=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&typeof window.orientation=="undefined";return{ltIE6:typeof window.addEventListener=="undefined"&&typeof document.documentElement.style.maxHeight=="undefined",ltIE7:typeof window.addEventListener=="undefined"&&typeof document.querySelectorAll=="undefined",ltIE8:typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined",IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:webkit,Chrome:webkit&&window.chrome,Safari:webkit&&!window.chrome,Mobile:typeof window.orientation!="undefined"};})();this.options=$.extend(true,{},this._options,opts||{});if(opts.ui){this.options.ui=opts.ui;}if(opts.commands){this.options.commands=opts.commands;}if(opts.uiOptions&&opts.uiOptions.toolbar){this.options.uiOptions.toolbar=opts.uiOptions.toolbar;}$.extend(this.options.contextmenu,opts.contextmenu);this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=$.isPlainObject(this.options.customData)?this.options.customData:{};this.id=id;this.uploadURL=opts.urlUpload||opts.url;this.namespace=namespace;this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en";i18n=this.lang=="en"?this.i18.en:$.extend(true,{},this.i18.en,this.i18[this.lang]);this.direction=i18n.direction;this.messages=i18n.messages;this.dateFormat=this.options.dateFormat||i18n.dateFormat;this.fancyFormat=this.options.fancyDateFormat||i18n.fancyDateFormat;this.today=(new Date(date.getFullYear(),date.getMonth(),date.getDate())).getTime()/1000;this.yesterday=this.today-86400;utc=this.options.UTCDate?"UTC":"";this.getHours="get"+utc+"Hours";this.getMinutes="get"+utc+"Minutes";this.getSeconds="get"+utc+"Seconds";this.getDate="get"+utc+"Date";this.getDay="get"+utc+"Day";this.getMonth="get"+utc+"Month";this.getFullYear="get"+utc+"FullYear";this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+(this.direction=="rtl"?"rtl":"ltr")+" "+this.options.cssClass;this.storage=(function(){try{return"localStorage" in window&&window.localStorage!==null?self.localStorage:self.cookie;}catch(e){return self.cookie;}})();this.viewType=this.storage("view")||this.options.defaultView||"icons";this.sortType=this.storage("sortType")||this.options.sortType||"name";this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc";this.sortStickFolders=this.storage("sortStickFolders");if(this.sortStickFolders===null){this.sortStickFolders=!!this.options.sortStickFolders;}else{this.sortStickFolders=!!this.sortStickFolders;}this.sortRules=$.extend(true,{},this._sortRules,this.options.sortsRules);$.each(this.sortRules,function(name,method){if(typeof method!="function"){delete self.sortRules[name];}});this.compare=$.proxy(this.compare,this);this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500;this.draggable={appendTo:"body",addClasses:true,delay:30,distance:8,revert:true,refreshPositions:true,cursor:"move",cursorAt:{left:50,top:47},drag:function(e,ui){if(!ui.helper.data("locked")){ui.helper.toggleClass("elfinder-drag-helper-plus",e.shiftKey||e.ctrlKey||e.metaKey);}},start:function(e,ui){var targets=$.map(ui.helper.data("files")||[],function(h){return h||null;}),cnt,h;cnt=targets.length;while(cnt--){h=targets[cnt];if(files[h].locked){ui.helper.addClass("elfinder-drag-helper-plus").data("locked",true);break;}}},stop:function(){self.trigger("focus").trigger("dragstop");},helper:function(e,ui){var element=this.id?$(this):$(this).parents("[id]:first"),helper=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),icon=function(mime){return'<div class="elfinder-cwd-icon '+self.mime2class(mime)+' ui-corner-all"/>';},hashes,l;self.trigger("dragstart",{target:element[0],originalEvent:e});hashes=element.is("."+self.res("class","cwdfile"))?self.selected():[self.navId2Hash(element.attr("id"))];helper.append(icon(files[hashes[0]].mime)).data("files",hashes).data("locked",false);if((l=hashes.length)>1){helper.append(icon(files[hashes[l-1]].mime)+'<span class="elfinder-drag-num">'+l+"</span>");}return helper;}};this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(e,ui){var dst=$(this),targets=$.map(ui.helper.data("files")||[],function(h){return h||null;}),result=[],c="class",cnt,hash,i,h;if(dst.is("."+self.res(c,"cwd"))){hash=cwd;}else{if(dst.is("."+self.res(c,"cwdfile"))){hash=dst.attr("id");}else{if(dst.is("."+self.res(c,"navdir"))){hash=self.navId2Hash(dst.attr("id"));}}}cnt=targets.length;while(cnt--){h=targets[cnt];h!=hash&&files[h].phash!=hash&&result.push(h);}if(result.length){ui.helper.hide();self.clipboard(result,!(e.ctrlKey||e.shiftKey||e.metaKey||ui.helper.data("locked")));self.exec("paste",hash);self.trigger("drop",{files:targets});}}};this.enabled=function(){return node.is(":visible")&&enabled;};this.visible=function(){return node.is(":visible");};this.root=function(hash){var dir=files[hash||cwd],i;while(dir&&dir.phash){dir=files[dir.phash];}if(dir){return dir.hash;}while(i in files&&files.hasOwnProperty(i)){dir=files[i];if(!dir.phash&&!dir.mime=="directory"&&dir.read){return dir.hash;}}return"";};this.cwd=function(){return files[cwd]||{};};this.option=function(name){return cwdOptions[name]||"";};this.file=function(hash){return files[hash];};this.files=function(){return $.extend(true,{},files);};this.parents=function(hash){var parents=[],dir;while((dir=this.file(hash))){parents.unshift(dir.hash);hash=dir.phash;}return parents;};this.path2array=function(hash,i18){var file,path=[];while(hash&&(file=files[hash])&&file.hash){path.unshift(i18&&file.i18?file.i18:file.name);hash=file.phash;}return path;};this.path=function(hash,i18){return files[hash]&&files[hash].path?files[hash].path:this.path2array(hash,i18).join(cwdOptions.separator);};this.url=function(hash){var file=files[hash];if(!file||!file.read){return"";}if(file.url){return file.url;}if(cwdOptions.url){return cwdOptions.url+$.map(this.path2array(hash),function(n){return encodeURIComponent(n);}).slice(1).join("/");}var params=$.extend({},this.customData,{cmd:"file",target:file.hash});if(this.oldAPI){params.cmd="open";params.current=file.phash;}return this.options.url+(this.options.url.indexOf("?")===-1?"?":"&")+$.param(params,true);};this.tmb=function(hash){var file=files[hash],url=file&&file.tmb&&file.tmb!=1?cwdOptions.tmbUrl+file.tmb:"";if(url&&(this.UA.Opera||this.UA.IE)){url+="?_="+new Date().getTime();}return url;};this.selected=function(){return selected.slice(0);};this.selectedFiles=function(){return $.map(selected,function(hash){return files[hash]?$.extend({},files[hash]):null;});};this.fileByName=function(name,phash){var hash;for(hash in files){if(files.hasOwnProperty(hash)&&files[hash].phash==phash&&files[hash].name==name){return files[hash];}}};this.validResponse=function(cmd,data){return data.error||this.rules[this.rules[cmd]?cmd:"defaults"](data);};this.request=function(options){var self=this,o=this.options,dfrd=$.Deferred(),data=$.extend({},o.customData,{mimes:o.onlyMimes},options.data||options),cmd=data.cmd,deffail=!(options.preventDefault||options.preventFail),defdone=!(options.preventDefault||options.preventDone),notify=$.extend({},options.notify),raw=!!options.raw,syncOnFail=options.syncOnFail,timeout,options=$.extend({url:o.url,async:true,type:this.requestType,dataType:"json",cache:false,data:data},options.options||{}),done=function(data){data.warning&&self.error(data.warning);cmd=="open"&&open($.extend(true,{},data));data.removed&&data.removed.length&&self.remove(data);data.added&&data.added.length&&self.add(data);data.changed&&data.changed.length&&self.change(data);self.trigger(cmd,data);data.sync&&self.sync();},error=function(xhr,status){var error;switch(status){case"abort":error=xhr.quiet?"":["errConnect","errAbort"];break;case"timeout":error=["errConnect","errTimeout"];break;case"parsererror":error=["errResponse","errDataNotJSON"];break;default:if(xhr.status==403){error=["errConnect","errAccess"];}else{if(xhr.status==404){error=["errConnect","errNotFound"];}else{error="errConnect";}}}dfrd.reject(error,xhr,status);},success=function(response){if(raw){return dfrd.resolve(response);}if(!response){return dfrd.reject(["errResponse","errDataEmpty"],xhr);}else{if(!$.isPlainObject(response)){return dfrd.reject(["errResponse","errDataNotJSON"],xhr);}else{if(response.error){return dfrd.reject(response.error,xhr);}else{if(!self.validResponse(cmd,response)){return dfrd.reject("errResponse",xhr);}}}}response=self.normalize(response);if(!self.api){self.api=response.api||1;self.newAPI=self.api>=2;self.oldAPI=!self.newAPI;}if(response.options){cwdOptions=$.extend({},cwdOptions,response.options);}if(response.netDrivers){self.netDrivers=response.netDrivers;}dfrd.resolve(response);response.debug&&self.debug("backend-debug",response.debug);},xhr,_xhr;defdone&&dfrd.done(done);dfrd.fail(function(error){if(error){deffail?self.error(error):self.debug("error",self.i18n(error));}});if(!cmd){return dfrd.reject("errCmdReq");}if(syncOnFail){dfrd.fail(function(error){error&&self.sync();});}if(notify.type&&notify.cnt){timeout=setTimeout(function(){self.notify(notify);dfrd.always(function(){notify.cnt=-(parseInt(notify.cnt)||0);self.notify(notify);});},self.notifyDelay);dfrd.always(function(){clearTimeout(timeout);});}if(cmd=="open"){while((_xhr=queue.pop())){if(_xhr.state()=="pending"){_xhr.quiet=true;_xhr.abort();}}}delete options.preventFail;xhr=this.transport.send(options).fail(error).done(success);if(cmd=="open"){queue.unshift(xhr);dfrd.always(function(){var ndx=$.inArray(xhr,queue);ndx!==-1&&queue.splice(ndx,1);});}return dfrd;};this.diff=function(incoming){var raw={},added=[],removed=[],changed=[],isChanged=function(hash){var l=changed.length;while(l--){if(changed[l].hash==hash){return true;}}};$.each(incoming,function(i,f){raw[f.hash]=f;});$.each(files,function(hash,f){!raw[hash]&&removed.push(hash);});$.each(raw,function(hash,file){var origin=files[hash];if(!origin){added.push(file);}else{$.each(file,function(prop){if(file[prop]!=origin[prop]){changed.push(file);return false;}});}});$.each(removed,function(i,hash){var file=files[hash],phash=file.phash;if(phash&&file.mime=="directory"&&$.inArray(phash,removed)===-1&&raw[phash]&&!isChanged(phash)){changed.push(raw[phash]);}});return{added:added,removed:removed,changed:changed};};this.sync=function(){var self=this,dfrd=$.Deferred().done(function(){self.trigger("sync");}),opts1={data:{cmd:"open",init:1,target:cwd,tree:this.ui.tree?1:0},preventDefault:true},opts2={data:{cmd:"tree",target:(cwd==this.root())?cwd:this.file(cwd).phash},preventDefault:true};$.when(this.request(opts1),this.request(opts2)).fail(function(error){dfrd.reject(error);error&&self.request({data:{cmd:"open",target:self.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:true},preventDefault:true});}).done(function(odata,pdata){var diff=self.diff(odata.files.concat(pdata&&pdata.tree?pdata.tree:[]));diff.added.push(odata.cwd);diff.removed.length&&self.remove(diff);diff.added.length&&self.add(diff);diff.changed.length&&self.change(diff);return dfrd.resolve(diff);});return dfrd;};this.upload=function(files){return this.transport.upload(files,this);};this.bind=function(event,callback){var i;if(typeof(callback)=="function"){event=(""+event).toLowerCase().split(/\s+/);for(i=0;i<event.length;i++){if(listeners[event[i]]===void (0)){listeners[event[i]]=[];}listeners[event[i]].push(callback);}}return this;};this.unbind=function(event,callback){var l=listeners[(""+event).toLowerCase()]||[],i=l.indexOf(callback);i>-1&&l.splice(i,1);callback=null;return this;};this.trigger=function(event,data){var event=event.toLowerCase(),handlers=listeners[event]||[],i,j;this.debug("event-"+event,data);if(handlers.length){event=$.Event(event);for(i=0;i<handlers.length;i++){event.data=$.extend(true,{},data);try{if(handlers[i](event,this)===false||event.isDefaultPrevented()){this.debug("event-stoped",event.type);break;}}catch(ex){window.console&&window.console.log&&window.console.log(ex);}}}return this;};this.shortcut=function(s){var patterns,pattern,code,i,parts;if(this.options.allowShortcuts&&s.pattern&&$.isFunction(s.callback)){patterns=s.pattern.toUpperCase().split(/\s+/);for(i=0;i<patterns.length;i++){pattern=patterns[i];parts=pattern.split("+");code=(code=parts.pop()).length==1?code>0?code:code.charCodeAt(0):$.ui.keyCode[code];if(code&&!shortcuts[pattern]){shortcuts[pattern]={keyCode:code,altKey:$.inArray("ALT",parts)!=-1,ctrlKey:$.inArray("CTRL",parts)!=-1,shiftKey:$.inArray("SHIFT",parts)!=-1,type:s.type||"keydown",callback:s.callback,description:s.description,pattern:pattern};}}}return this;};this.shortcuts=function(){var ret=[];$.each(shortcuts,function(i,s){ret.push([s.pattern,self.i18n(s.description)]);});return ret;};this.clipboard=function(hashes,cut){var map=function(){return $.map(clipboard,function(f){return f.hash;});};if(hashes!==void (0)){clipboard.length&&this.trigger("unlockfiles",{files:map()});remember=[];clipboard=$.map(hashes||[],function(hash){var file=files[hash];if(file){remember.push(hash);return{hash:hash,phash:file.phash,name:file.name,mime:file.mime,read:file.read,locked:file.locked,cut:!!cut};}return null;});this.trigger("changeclipboard",{clipboard:clipboard.slice(0,clipboard.length)});cut&&this.trigger("lockfiles",{files:map()});}return clipboard.slice(0,clipboard.length);};this.isCommandEnabled=function(name){return this._commands[name]?$.inArray(name,cwdOptions.disabled)===-1:false;};this.exec=function(cmd,files,opts){return this._commands[cmd]&&this.isCommandEnabled(cmd)?this._commands[cmd].exec(files,opts):$.Deferred().reject("No such command");};this.dialog=function(content,options){return $("<div/>").append(content).appendTo(node).elfinderdialog(options);};this.getUI=function(ui){return this.ui[ui]||node;};this.command=function(name){return name===void (0)?this._commands:this._commands[name];};this.resize=function(w,h){node.css("width",w).height(h).trigger("resize");this.trigger("resize",{width:node.width(),height:node.height()});};this.restoreSize=function(){this.resize(width,height);};this.show=function(){node.show();this.enable().trigger("show");};this.hide=function(){this.disable().trigger("hide");node.hide();};this.destroy=function(){if(node&&node[0].elfinder){this.trigger("destroy").disable();listeners={};shortcuts={};$(document).add(node).unbind("."+this.namespace);self.trigger=function(){};node.children().remove();node.append(prevContent.contents()).removeClass(this.cssClass).attr("style",prevStyle);node[0].elfinder=null;if(syncInterval){clearInterval(syncInterval);}}};if(!($.fn.selectable&&$.fn.draggable&&$.fn.droppable)){return alert(this.i18n("errJqui"));}if(!node.length){return alert(this.i18n("errNode"));}if(!this.options.url){return alert(this.i18n("errURL"));}$.extend($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120});this.dragUpload=false;this.xhrUpload=(typeof XMLHttpRequestUpload!="undefined"||typeof XMLHttpRequestEventTarget!="undefined")&&typeof File!="undefined"&&typeof FormData!="undefined";this.transport={};if(typeof(this.options.transport)=="object"){this.transport=this.options.transport;if(typeof(this.transport.init)=="function"){this.transport.init(this);}}if(typeof(this.transport.send)!="function"){this.transport.send=function(opts){return $.ajax(opts);};}if(this.transport.upload=="iframe"){this.transport.upload=$.proxy(this.uploads.iframe,this);}else{if(typeof(this.transport.upload)=="function"){this.dragUpload=!!this.options.dragUploadAllow;}else{if(this.xhrUpload&&!!this.options.dragUploadAllow){this.transport.upload=$.proxy(this.uploads.xhr,this);this.dragUpload=true;}else{this.transport.upload=$.proxy(this.uploads.iframe,this);}}}this.error=function(){var arg=arguments[0];return arguments.length==1&&typeof(arg)=="function"?self.bind("error",arg):self.trigger("error",{error:arg});};$.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop","search","searchend","viewchange"],function(i,name){self[name]=function(){var arg=arguments[0];return arguments.length==1&&typeof(arg)=="function"?self.bind(name,arg):self.trigger(name,$.isPlainObject(arg)?arg:{});};});this.enable(function(){if(!enabled&&self.visible()&&self.ui.overlay.is(":hidden")){enabled=true;$("texarea:focus,input:focus,button").blur();node.removeClass("elfinder-disabled");}}).disable(function(){prevEnabled=enabled;enabled=false;node.addClass("elfinder-disabled");}).open(function(){selected=[];}).select(function(e){selected=$.map(e.data.selected||e.data.value||[],function(hash){return files[hash]?hash:null;});}).error(function(e){var opts={cssClass:"elfinder-dialog-error",title:self.i18n(self.i18n("error")),resizable:false,destroyOnClose:true,buttons:{}};opts.buttons[self.i18n(self.i18n("btnClose"))]=function(){$(this).elfinderdialog("close");};self.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+self.i18n(e.data.error),opts);}).bind("tree parents",function(e){cache(e.data.tree||[]);}).bind("tmb",function(e){$.each(e.data.images||[],function(hash,tmb){if(files[hash]){files[hash].tmb=tmb;}});}).add(function(e){cache(e.data.added||[]);}).change(function(e){$.each(e.data.changed||[],function(i,file){var hash=file.hash;if((files[hash].width&&!file.width)||(files[hash].height&&!file.height)){files[hash].width=undefined;files[hash].height=undefined;}files[hash]=files[hash]?$.extend(files[hash],file):file;});}).remove(function(e){var removed=e.data.removed||[],l=removed.length,rm=function(hash){var file=files[hash];if(file){if(file.mime=="directory"&&file.dirs){$.each(files,function(h,f){f.phash==hash&&rm(h);});}delete files[hash];}};while(l--){rm(removed[l]);}}).bind("search",function(e){cache(e.data.files);}).bind("rm",function(e){var play=beeper.canPlayType&&beeper.canPlayType('audio/wav; codecs="1"');play&&play!=""&&play!="no"&&$(beeper).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play();});$.each(this.options.handlers,function(event,callback){self.bind(event,callback);});this.history=new this.history(this);if(typeof(this.options.getFileCallback)=="function"&&this.commands.getfile){this.bind("dblclick",function(e){e.preventDefault();self.exec("getfile").fail(function(){self.exec("open");});});this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){self.exec("getfile").fail(function(){self.exec(self.OS=="mac"?"rename":"open");});}}).shortcut({pattern:"ctrl+enter",description:this.i18n(this.OS=="mac"?"cmdrename":"cmdopen"),callback:function(){self.exec(self.OS=="mac"?"rename":"open");}});}this._commands={};if(!$.isArray(this.options.commands)){this.options.commands=[];}$.each(["open","reload","back","forward","up","home","info","quicklook","getfile","help"],function(i,cmd){$.inArray(cmd,self.options.commands)===-1&&self.options.commands.push(cmd);});$.each(this.options.commands,function(i,name){var cmd=self.commands[name];if($.isFunction(cmd)&&!self._commands[name]){cmd.prototype=base;self._commands[name]=new cmd();self._commands[name].setup(name,self.options.commandsOptions[name]||{});}});node.addClass(this.cssClass).bind(mousedown,function(){!enabled&&self.enable();});this.ui={workzone:$("<div/>").appendTo(node).elfinderworkzone(this),navbar:$("<div/>").appendTo(node).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:$("<div/>").appendTo(node).elfindercontextmenu(this),overlay:$("<div/>").appendTo(node).elfinderoverlay({show:function(){self.disable();},hide:function(){prevEnabled&&self.enable();}}),cwd:$("<div/>").appendTo(node).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:false,autoOpen:false,title:"&nbsp;",width:280}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(node)};$.each(this.options.ui||[],function(i,ui){var name="elfinder"+ui,opts=self.options.uiOptions[ui]||{};if(!self.ui[ui]&&$.fn[name]){self.ui[ui]=$("<"+(opts.tag||"div")+"/>").appendTo(node)[name](self,opts);}});node[0].elfinder=this;this.options.resizable&&$.fn.resizable&&node.resizable({handles:"s",minWidth:300,minHeight:200});if(this.options.width){width=this.options.width;}if(this.options.height){height=parseInt(this.options.height);}self.resize(width,height);$(document).bind("click."+this.namespace,function(e){enabled&&!$(e.target).closest(node).length&&self.disable();}).bind(keydown+" "+keypress,execShortcut);self.options.useBrowserHistory&&$(window).on("popstate",function(ev){var target=ev.originalEvent.state&&ev.originalEvent.state.thash;target&&!$.isEmptyObject(self.files())&&self.request({data:{cmd:"open",target:target,onhistory:1},notify:{type:"open",cnt:1,hideCnt:true},syncOnFail:true});});this.trigger("init").request({data:{cmd:"open",target:self.startDir(),init:1,tree:this.ui.tree?1:0},preventDone:true,notify:{type:"open",cnt:1,hideCnt:true},freeze:true}).fail(function(){self.trigger("fail").disable().lastDir("");listeners={};shortcuts={};$(document).add(node).unbind("."+this.namespace);self.trigger=function(){};}).done(function(data){self.load().debug("api",self.api);data=$.extend(true,{},data);open(data);self.trigger("open",data);});this.one("load",function(){node.trigger("resize");if(self.options.sync>1000){syncInterval=setInterval(function(){self.sync();},self.options.sync);}});};elFinder.prototype={res:function(type,id){return this.resources[type]&&this.resources[type][id];},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(data){if(!data||(data.added&&!$.isArray(data.added))||(data.removed&&!$.isArray(data.removed))||(data.changed&&!$.isArray(data.changed))){return false;}return true;},open:function(data){return data&&data.cwd&&data.files&&$.isPlainObject(data.cwd)&&$.isArray(data.files);},tree:function(data){return data&&data.tree&&$.isArray(data.tree);},parents:function(data){return data&&data.tree&&$.isArray(data.tree);},tmb:function(data){return data&&data.images&&($.isPlainObject(data.images)||$.isArray(data.images));},upload:function(data){return data&&($.isPlainObject(data.added)||$.isArray(data.added));},search:function(data){return data&&data.files&&$.isArray(data.files);}},commands:{},parseUploadData:function(text){var data;if(!$.trim(text)){return{error:["errResponse","errDataEmpty"]};}try{data=$.parseJSON(text);}catch(e){return{error:["errResponse","errDataNotJSON"]};}if(!this.validResponse("upload",data)){return{error:["errResponse"]};}data=this.normalize(data);data.removed=$.map(data.added||[],function(f){return f.hash;});return data;},iframeCnt:0,uploads:{iframe:function(data,fm){var self=fm?fm:this,input=data.input,dfrd=$.Deferred().fail(function(error){error&&self.error(error);}).done(function(data){data.warning&&self.error(data.warning);data.removed&&self.remove(data);data.added&&self.add(data);data.changed&&self.change(data);self.trigger("upload",data);data.sync&&self.sync();}),name="iframe-"+self.namespace+(++self.iframeCnt),form=$('<form action="'+self.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+name+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),msie=this.UA.IE,onload=function(){abortto&&clearTimeout(abortto);notifyto&&clearTimeout(notifyto);notify&&self.notify({type:"upload",cnt:-cnt});setTimeout(function(){msie&&$('<iframe src="javascript:false;"/>').appendTo(form);form.remove();iframe.remove();},100);},iframe=$('<iframe src="'+(msie?"javascript:false;":"about:blank")+'" name="'+name+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){iframe.unbind("load").bind("load",function(){var data=self.parseUploadData(iframe.contents().text());onload();data.error?dfrd.reject(data.error):dfrd.resolve(data);});notifyto=setTimeout(function(){notify=true;self.notify({type:"upload",cnt:cnt});},self.options.notifyDelay);if(self.options.iframeTimeout>0){abortto=setTimeout(function(){onload();dfrd.reject([errors.connect,errors.timeout]);},self.options.iframeTimeout);}form.submit();}),cnt,notify,notifyto,abortto;if(input&&$(input).is(":file")&&$(input).val()){form.append(input);}else{return dfrd.reject();}cnt=input.files?input.files.length:1;form.append('<input type="hidden" name="'+(self.newAPI?"target":"current")+'" value="'+self.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append($(input).attr("name","upload[]"));$.each(self.options.onlyMimes||[],function(i,mime){form.append('<input type="hidden" name="mimes[]" value="'+mime+'"/>');});$.each(self.options.customData,function(key,val){form.append('<input type="hidden" name="'+key+'" value="'+val+'"/>');});form.appendTo("body");iframe.appendTo("body");return dfrd;},xhr:function(data,fm){var self=fm?fm:this,dfrd=$.Deferred().fail(function(error){error&&self.error(error);}).done(function(data){data.warning&&self.error(data.warning);data.removed&&self.remove(data);data.added&&self.add(data);data.changed&&self.change(data);self.trigger("upload",data);data.sync&&self.sync();}).always(function(){notifyto&&clearTimeout(notifyto);notify&&self.notify({type:"upload",cnt:-cnt,progress:100*cnt});}),xhr=new XMLHttpRequest(),formData=new FormData(),files=data.input?data.input.files:data.files,cnt=files.length,loaded=5,notify=false,startNotify=function(){return setTimeout(function(){notify=true;self.notify({type:"upload",cnt:cnt,progress:loaded*cnt});},self.options.notifyDelay);},notifyto;if(!cnt){return dfrd.reject();}xhr.addEventListener("error",function(){dfrd.reject("errConnect");},false);xhr.addEventListener("abort",function(){dfrd.reject(["errConnect","errAbort"]);},false);xhr.addEventListener("load",function(){var status=xhr.status,data;if(status>500){return dfrd.reject("errResponse");}if(status!=200){return dfrd.reject("errConnect");}if(xhr.readyState!=4){return dfrd.reject(["errConnect","errTimeout"]);}if(!xhr.responseText){return dfrd.reject(["errResponse","errDataEmpty"]);}data=self.parseUploadData(xhr.responseText);data.error?dfrd.reject(data.error):dfrd.resolve(data);},false);xhr.upload.addEventListener("progress",function(e){var prev=loaded,curr;if(e.lengthComputable){curr=parseInt(e.loaded*100/e.total);if(curr>0&&!notifyto){notifyto=startNotify();}if(curr-prev>4){loaded=curr;notify&&self.notify({type:"upload",cnt:0,progress:(loaded-prev)*cnt});}}},false);xhr.open("POST",self.uploadURL,true);formData.append("cmd","upload");formData.append(self.newAPI?"target":"current",self.cwd().hash);$.each(self.options.customData,function(key,val){formData.append(key,val);});$.each(self.options.onlyMimes,function(i,mime){formData.append("mimes["+i+"]",mime);});$.each(files,function(i,file){formData.append("upload[]",file);});xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==0){dfrd.reject(["errConnect","errAbort"]);}};xhr.send(formData);if(!this.UA.Safari||!data.files){notifyto=startNotify();}return dfrd;}},one:function(event,callback){var self=this,h=$.proxy(callback,function(event){setTimeout(function(){self.unbind(event.type,h);},3);return callback.apply(this,arguments);});return this.bind(event,h);},localStorage:function(key,val){var s=window.localStorage;key="elfinder-"+key+this.id;if(val===null){console.log("remove",key);return s.removeItem(key);}if(val!==void (0)){try{s.setItem(key,val);}catch(e){s.clear();s.setItem(key,val);}}return s.getItem(key);},cookie:function(name,value){var d,o,c,i;name="elfinder-"+name+this.id;if(value===void (0)){if(document.cookie&&document.cookie!=""){c=document.cookie.split(";");name+="=";for(i=0;i<c.length;i++){c[i]=$.trim(c[i]);if(c[i].substring(0,name.length)==name){return decodeURIComponent(c[i].substring(name.length));}}}return"";}o=$.extend({},this.options.cookie);if(value===null){value="";o.expires=-1;}if(typeof(o.expires)=="number"){d=new Date();d.setTime(d.getTime()+(o.expires*86400000));o.expires=d;}document.cookie=name+"="+encodeURIComponent(value)+"; expires="+o.expires.toUTCString()+(o.path?"; path="+o.path:"")+(o.domain?"; domain="+o.domain:"")+(o.secure?"; secure":"");return value;},startDir:function(){var locHash=window.location.hash;if(locHash&&locHash.match(/^#elf_/)){return locHash.replace(/^#elf_/,"");}else{return this.lastDir();}},lastDir:function(hash){return this.options.rememberLastDir?this.storage("lastdir",hash):"";},_node:$("<span/>"),escape:function(name){return this._node.text(name).html();},normalize:function(data){var filter=function(file){if(file&&file.hash&&file.name&&file.mime){if(file.mime=="application/x-empty"){file.mime="text/plain";}return file;}return null;return file&&file.hash&&file.name&&file.mime?file:null;};if(data.files){data.files=$.map(data.files,filter);}if(data.tree){data.tree=$.map(data.tree,filter);}if(data.added){data.added=$.map(data.added,filter);}if(data.changed){data.changed=$.map(data.changed,filter);}if(data.api){data.init=true;}return data;},setSort:function(type,order,stickFolders){this.storage("sortType",(this.sortType=this.sortRules[type]?type:"name"));this.storage("sortOrder",(this.sortOrder=/asc|desc/.test(order)?order:"asc"));this.storage("sortStickFolders",(this.sortStickFolders=!!stickFolders)?1:"");this.trigger("sortchange");},_sortRules:{name:function(file1,file2){return file1.name.toLowerCase().localeCompare(file2.name.toLowerCase());},size:function(file1,file2){var size1=parseInt(file1.size)||0,size2=parseInt(file2.size)||0;return size1==size2?0:size1>size2?1:-1;return(parseInt(file1.size)||0)>(parseInt(file2.size)||0)?1:-1;},kind:function(file1,file2){return file1.mime.localeCompare(file2.mime);},date:function(file1,file2){var date1=file1.ts||file1.date,date2=file2.ts||file2.date;return date1==date2?0:date1>date2?1:-1;}},compare:function(file1,file2){var self=this,type=self.sortType,asc=self.sortOrder=="asc",stick=self.sortStickFolders,rules=self.sortRules,sort=rules[type],d1=file1.mime=="directory",d2=file2.mime=="directory",res;if(stick){if(d1&&!d2){return -1;}else{if(!d1&&d2){return 1;}}}res=asc?sort(file1,file2):sort(file2,file1);return type!="name"&&res==0?res=asc?rules.name(file1,file2):rules.name(file2,file1):res;},sortFiles:function(files){return files.sort(this.compare);},notify:function(opts){var type=opts.type,msg=this.messages["ntf"+type]?this.i18n("ntf"+type):this.i18n("ntfsmth"),ndialog=this.ui.notify,notify=ndialog.children(".elfinder-notify-"+type),ntpl='<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>',delta=opts.cnt,progress=opts.progress>=0&&opts.progress<=100?opts.progress:0,cnt,total,prc;if(!type){return this;}if(!notify.length){notify=$(ntpl.replace(/\{type\}/g,type).replace(/\{msg\}/g,msg)).appendTo(ndialog).data("cnt",0);if(progress){notify.data({progress:0,total:0});}}cnt=delta+parseInt(notify.data("cnt"));if(cnt>0){!opts.hideCnt&&notify.children(".elfinder-notify-cnt").text("("+cnt+")");ndialog.is(":hidden")&&ndialog.elfinderdialog("open");notify.data("cnt",cnt);if(progress<100&&(total=notify.data("total"))>=0&&(prc=notify.data("progress"))>=0){total=delta+parseInt(notify.data("total"));prc=progress+prc;progress=parseInt(prc/total);notify.data({progress:prc,total:total});ndialog.find(".elfinder-notify-progress").animate({width:(progress<100?progress:100)+"%"},20);}}else{notify.remove();!ndialog.children().length&&ndialog.elfinderdialog("close");}return this;},confirm:function(opts){var complete=false,options={cssClass:"elfinder-dialog-confirm",modal:true,resizable:false,title:this.i18n(opts.title||"confirmReq"),buttons:{},close:function(){!complete&&opts.cancel.callback();$(this).elfinderdialog("destroy");}},apply=this.i18n("apllyAll"),label,checkbox;if(opts.reject){options.buttons[this.i18n(opts.reject.label)]=function(){opts.reject.callback(!!(checkbox&&checkbox.prop("checked")));complete=true;$(this).elfinderdialog("close");};}options.buttons[this.i18n(opts.accept.label)]=function(){opts.accept.callback(!!(checkbox&&checkbox.prop("checked")));complete=true;$(this).elfinderdialog("close");};options.buttons[this.i18n(opts.cancel.label)]=function(){$(this).elfinderdialog("close");};if(opts.all){if(opts.reject){options.width=370;}options.create=function(){checkbox=$('<input type="checkbox" />');$(this).next().children().before($("<label>"+apply+"</label>").prepend(checkbox));};options.open=function(){var pane=$(this).next(),width=parseInt(pane.children(":first").outerWidth()+pane.children(":last").outerWidth());if(width>parseInt(pane.width())){$(this).closest(".elfinder-dialog").width(width+30);}};}return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(opts.text),options);},uniqueName:function(prefix,phash){var i=0,ext="",p,name;prefix=this.i18n(prefix);phash=phash||this.cwd().hash;if((p=prefix.indexOf(".txt"))!=-1){ext=".txt";prefix=prefix.substr(0,p);}name=prefix+ext;if(!this.fileByName(name,phash)){return name;}while(i<10000){name=prefix+" "+(++i)+ext;if(!this.fileByName(name,phash)){return name;}}return prefix+Math.random()+ext;},i18n:function(){var self=this,messages=this.messages,input=[],ignore=[],message=function(m){var file;if(m.indexOf("#")===0){if((file=self.file(m.substr(1)))){return file.name;}}return m;},i,j,m;for(i=0;i<arguments.length;i++){m=arguments[i];if(typeof m=="string"){input.push(message(m));}else{if($.isArray(m)){for(j=0;j<m.length;j++){if(typeof m[j]=="string"){input.push(message(m[j]));}}}}}for(i=0;i<input.length;i++){if($.inArray(i,ignore)!==-1){continue;}m=input[i];m=messages[m]||m;m=m.replace(/\$(\d+)/g,function(match,placeholder){placeholder=i+parseInt(placeholder);if(placeholder>0&&input[placeholder]){ignore.push(placeholder);}return input[placeholder]||"";});input[i]=m;}return $.map(input,function(m,i){return $.inArray(i,ignore)===-1?m:null;}).join("<br>");},mime2class:function(mime){var prefix="elfinder-cwd-icon-";mime=mime.split("/");return prefix+mime[0]+(mime[0]!="image"&&mime[1]?" "+prefix+mime[1].replace(/(\.|\+)/g,"-"):"");},mime2kind:function(f){var mime=typeof(f)=="object"?f.mime:f,kind;if(f.alias){kind="Alias";}else{if(this.kinds[mime]){kind=this.kinds[mime];}else{if(mime.indexOf("text")===0){kind="Text";}else{if(mime.indexOf("image")===0){kind="Image";}else{if(mime.indexOf("audio")===0){kind="Audio";}else{if(mime.indexOf("video")===0){kind="Video";}else{if(mime.indexOf("application")===0){kind="App";}else{kind=mime;}}}}}}}return this.messages["kind"+kind]?this.i18n("kind"+kind):mime;var mime=typeof(f)=="object"?f.mime:f,kind=this.kinds[mime]||"unknown";if(f.alias){kind="Alias";}else{if(kind=="unknown"){if(mime.indexOf("text")===0){kind="Text";}else{if(mime.indexOf("image")===0){kind="Image";}else{if(mime.indexOf("audio")===0){kind="Audio";}else{if(mime.indexOf("video")===0){kind="Video";}else{if(mime.indexOf("application")===0){kind="Application";}}}}}}}return this.i18n(kind);},formatDate:function(file,ts){var self=this,ts=ts||file.ts,i18=self.i18,date,format,output,d,dw,m,y,h,g,i,s;if(self.options.clientFormatDate&&ts>0){date=new Date(ts*1000);h=date[self.getHours]();g=h>12?h-12:h;i=date[self.getMinutes]();s=date[self.getSeconds]();d=date[self.getDate]();dw=date[self.getDay]();m=date[self.getMonth]()+1;y=date[self.getFullYear]();format=ts>=this.yesterday?this.fancyFormat:this.dateFormat;output=format.replace(/[a-z]/gi,function(val){switch(val){case"d":return d>9?d:"0"+d;case"j":return d;case"D":return self.i18n(i18.daysShort[dw]);case"l":return self.i18n(i18.days[dw]);case"m":return m>9?m:"0"+m;case"n":return m;case"M":return self.i18n(i18.monthsShort[m-1]);case"F":return self.i18n(i18.months[m-1]);case"Y":return y;case"y":return(""+y).substr(2);case"H":return h>9?h:"0"+h;case"G":return h;case"g":return g;case"h":return g>9?g:"0"+g;case"a":return h>12?"pm":"am";case"A":return h>12?"PM":"AM";case"i":return i>9?i:"0"+i;case"s":return s>9?s:"0"+s;}return val;});return ts>=this.yesterday?output.replace("$1",this.i18n(ts>=this.today?"Today":"Yesterday")):output;}else{if(file.date){return file.date.replace(/([a-z]+)\s/i,function(a1,a2){return self.i18n(a2)+" ";});}}return self.i18n("dateUnknown");},perms2class:function(o){var c="";if(!o.read&&!o.write){c="elfinder-na";}else{if(!o.read){c="elfinder-wo";}else{if(!o.write){c="elfinder-ro";}}}return c;},formatPermissions:function(f){var p=[];f.read&&p.push(this.i18n("read"));f.write&&p.push(this.i18n("write"));return p.length?p.join(" "+this.i18n("and")+" "):this.i18n("noaccess");},formatSize:function(s){var n=1,u="b";if(s=="unknown"){return this.i18n("unknown");}if(s>1073741824){n=1073741824;u="GB";}else{if(s>1048576){n=1048576;u="MB";}else{if(s>1024){n=1024;u="KB";}}}s=s/n;return(s>0?n>=1048576?s.toFixed(2):Math.round(s):0)+" "+u;},navHash2Id:function(hash){return"nav-"+hash;},navId2Hash:function(id){return typeof(id)=="string"?id.substr(4):false;},log:function(m){window.console&&window.console.log&&window.console.log(m);return this;},debug:function(type,m){var d=this.options.debug;if(d=="all"||d===true||($.isArray(d)&&$.inArray(type,d)!=-1)){window.console&&window.console.log&&window.console.log("elfinder debug: ["+type+"] ["+this.id+"]",m);}return this;},time:function(l){window.console&&window.console.time&&window.console.time(l);},timeEnd:function(l){window.console&&window.console.timeEnd&&window.console.timeEnd(l);}};if(elFinder&&elFinder.prototype&&typeof(elFinder.prototype.i18)=="object"){elFinder.prototype.i18.ru={translator:'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;',language:"Русский язык",direction:"ltr",dateFormat:"d M Y H:i",fancyDateFormat:"$1 H:i",messages:{error:"Ошибка",errUnknown:"Неизвестная ошибка.",errUnknownCmd:"Неизвестная комманда.",errJqui:"Отсутствуют необходимые компоненты jQuery UI - selectable, draggable и droppable.",errNode:"Отсутствует DOM элемент для инициализации elFinder.",errURL:"Некорректная настройка. Необходимо указать URL сервера.",errAccess:"Доступ запрещен.",errConnect:"Не удалось соединиться с сервером.",errAbort:"Соединение прервано.",errTimeout:"Таймаут соединения.",errNotFound:"Сервер не найден.",errResponse:"Некорректный ответ сервера.",errConf:"Некорректная настройка сервера.",errJSON:"Модуль PHP JSON не установлен.",errNoVolumes:"Отсутствуют корневые директории достуные для чтения.",errCmdParams:'Некорректные параметры комманды "$1".',errDataNotJSON:"Данные не формате JSON.",errDataEmpty:"Данные отсутствуют.",errCmdReq:"Для запроса к серверу необходимо указать имя комманды.",errOpen:'Не удалось открыть "$1".',errNotFolder:"Объект не является папкой.",errNotFile:"Объект не является файлом.",errRead:'Ошибка чтения "$1".',errWrite:'Ошибка записи "$1".',errPerm:"Доступ запрещен.",errLocked:'"$1" защищен и не может быть переименован, перемещен или удален.',errExists:'В папке уже существует объект с именем "$1".',errInvName:"Недопустимое имя файла.",errFolderNotFound:"Папка не найдена.",errFileNotFound:"Файл не найден.",errTrgFolderNotFound:'Целевая папка "$1" не найдена.',errPopup:"Браузер заблокировал открытие нового окна. Чтобы окрыть файл, измените настройки браузера.",errMkdir:'Ошибка создания папки "$1".',errMkfile:'Ошибка создания файла "$1".',errRename:'Ошибка переименования "$1".',errCopyFrom:'Копирование из корневой директории "$1" запрещено.',errCopyTo:'Копирование в корневую директорию "$1" запрещено.',errUploadCommon:"Ошибка загрузки файлов.",errUpload:'Ошибка загрузки "$1".',errUploadNoFiles:"Отсутствуют загруженые файлы.",errMaxSize:"Превышен допустимый размер загружаемых файлов.",errFileMaxSize:"Размер файла превышает допустимый.",errUploadMime:"Недопустимый тип файла.",errUploadTransfer:'Ошибка передачи файла "$1".',errSave:'Ошибка сохранения "$1".',errCopy:'Ошибка копирования "$1".',errMove:'Ошибка перемещения "$1".',errCopyInItself:'Невозможно скопировать "$1" в самого себя.',errRm:'Ошибка удаления "$1".',errExtract:'Ошибка извлечения файлов из архива "$1".',errArchive:"Ошибка создания архива.",errArcType:"Неподдерживаемый тип архива.",errNoArchive:"Файл не является архивом допустимого типа.",errCmdNoSupport:"Сервер не поддерживает эту комманду.",errReplByChild:'Невозможно заменить папку "$1" содержащимся в ней объектом.',errArcSymlinks:"По соображениям безопасности запрещена распаковка архивов, содержащих ссылки (symlinks) или файлы с недопустимыми именами.",errArcMaxSize:"Размер файлов в архиве превышает максимально разрешенный.",errResize:'Не удалось изменить размер "$1".',errUsupportType:"Неподдерживаемый тип файла.",errNotUTF8Content:'Файл "$1" содержит текст в кодировке отличной от UTF-8 и не может быть отредактирован.',errNetMount:'Не удалось подключить "$1".',errNetMountNoDriver:"Неподдерживаемый протокол.",errNetMountFailed:"Ошибка монтирования.",errNetMountHostReq:"Host required.",errSessionExpires:"Сессия была завершена так как превышено время отсутствия активности",errCreatingTempDir:'Ошибка при создании временной директории: "$1"',errFtpDownloadFile:'Ошибка при скачивании файла с FTP: "$1"',errFtpUploadFile:'Ошибка при загрузке файла на FTP: "$1"',errFtpMkdir:'Ошибка при создании директории на FTP: "$1"',errArchiveExec:'Ошибка при выполнении архивации: "$1"',errExtractExec:'Ошибка при выполнении распаковки: "$1"',errUploadFile:'Невозможно загрузить файл "$1"',cmdarchive:"Создать архив",cmdback:"Назад",cmdcopy:"Копировать",cmdcut:"Вырезать",cmddownload:"Скачать",cmdduplicate:"Сделать копию",cmdedit:"Редактировать",cmdextract:"Распаковать архив",cmdforward:"Вперед",cmdgetfile:"Выбрать",cmdhelp:"О программе",cmdhome:"Домой",cmdinfo:"Свойства",cmdmkdir:"Новая папка",cmdmkfile:"Новый файл",cmdopen:"Открыть",cmdpaste:"Вставить",cmdquicklook:"Быстрый просмотр",cmdreload:"Обновить",cmdrename:"Переименовать",cmdrm:"Удалить",cmdsearch:"Поиск",cmdup:"Наверх",cmdupload:"Загрузить файлы",cmdview:"Вид",cmdresize:"Размер изображения",cmdsort:"Сортировать",btnClose:"Закрыть",btnSave:"Сохранить",btnRm:"Удалить",btnCancel:"Отмена",btnApply:"Применить",btnNo:"Нет",btnYes:"Да",btnMount:"Подключить",ntfopen:"Открытие папки",ntffile:"Открытие файла",ntfreload:"Обновление текущей папки",ntfmkdir:"Создание папки",ntfmkfile:"Создание файла",ntfrm:"Удаление файлов",ntfcopy:"Копирование файлов",ntfmove:"Перемещение файлов",ntfprepare:"Подготовка к копированию",ntfrename:"Переименование файлов",ntfupload:"Загрузка файлов",ntfdownload:"Скачивание файлов",ntfsave:"Сохранение файлов",ntfarchive:"Создание архива",ntfextract:"Распаковка архива",ntfsearch:"Поиск файлов",ntfsmth:"Занят важным делом",ntfnetmount:"Монтирую сетевой диск",dateUnknown:"Незвестно",Today:"Сегодня",Yesterday:"Вчера",Jan:"Янв",Feb:"Фев",Mar:"Мар",Apr:"Апр",May:"Май",Jun:"Июнь",Jul:"Июль",Aug:"Авг",Sep:"Сен",Oct:"Окт",Nov:"Ноя",Dec:"Дек",January:"Январь",February:"Февраль",March:"Март",April:"Апрель",May:"Май",June:"Июнь",July:"Июль",August:"Август",September:"Сентябрь",October:"Октябрь",November:"Ноябрь",December:"Декабрь",Sunday:"Воскресенье",Monday:"Понедельник",Tuesday:"Вторник",Wednesday:"Среда",Thursday:"Четверг",Friday:"Пятница",Saturday:"Суббота",Sun:"Вск",Mon:"Пнд",Tue:"Втр",Wed:"Срд",Thu:"Чтв",Fri:"Птн",Sat:"Сбт",sortname:"по имени",sortkind:"по типу",sortsize:"по размеру",sortdate:"по дате",sortFoldersFirst:"Папки в начале",confirmReq:"Необходимо подтверждение.",confirmRm:"Хотите удалить файлы?<br>Действие необратимо.",confirmRepl:"Заменить старый файл новым?",apllyAll:"для всех",name:"Имя файла",size:"Размер",perms:"Доступ",modify:"Изменен",kind:"Тип",read:"чтение",write:"запись",noaccess:"нет доступа",and:"и",unknown:"неизвестно",selectall:"Выбрать все файлы",selectfiles:"Выбрать файл(ы)",selectffile:"Выбрать первый файл",selectlfile:"Выбрать последний файл",viewlist:"В виде списка",viewicons:"В виде иконок",places:"Избранное",calc:"вычисляю",path:"Путь",aliasfor:"Указывает на",locked:"Защита",dim:"Разрешение",files:"Файлы",folders:"Папки",items:"Объекты",yes:"да",no:"нет",link:"Ссылка",searcresult:"Результаты поиска",selected:"выбрано",about:"О программе",shortcuts:"Горячие клавиши",help:"Помощь",webfm:"Файловый менеджер для web",ver:"Версия",protocolver:"версия протокола",homepage:"Сайт проекта",docs:"Документация",github:"Fork us on Github",twitter:"Follow us in twitter",facebook:"Join us on facebook",team:"Авторы",chiefdev:"ведущий разработчик",developer:"разработчик",contributor:"участник",maintainer:"сопровождение проекта",translator:"переводчик",icons:"Иконки",dontforget:"и не забудьте взять своё полотенце",shortcutsof:"Горячие клавиши отключены",dropFiles:"Бросить файлы",or:"или",selectForUpload:"Выбрать файлы для загрузки",moveFiles:"Перемещение файлов",copyFiles:"Копирование файлов",rmFromPlaces:"Удалить из избранного","untitled folder":"новая папка","untitled file.txt":"новый файл.txt",aspectRatio:"Сохранять пропорции",scale:"Масштаб",width:"Ширина",height:"Высота",resize:"Размер",crop:"Кадрировать",rotate:"Поворот","rotate-cw":"Поворот на 90 градусов по часовой стрелке","rotate-ccw":"Поворот на 90 градусов против часовой стрелке",degree:"°",netMountDialogTitle:"Подключить сетевой диск",protocol:"Протокол",host:"Хост",port:"Порт",user:"Пользователь",pass:"Пароль",kindUnknown:"Неизвестный",kindFolder:"Папка",kindAlias:"Ссылка",kindAliasBroken:"Битая ссылка",kindApp:"Приложение",kindPostscript:"Документ Postscript",kindMsOffice:"Документ Microsoft Office",kindMsWord:"Документ Microsoft Word",kindMsExcel:"Документ Microsoft Excel",kindMsPP:"Презентация Microsoft Powerpoint",kindOO:"Документ Open Office",kindAppFlash:"Приложение Flash",kindPDF:"Документ PDF",kindTorrent:"Файл Bittorrent",kind7z:"Архив 7z",kindTAR:"Архив TAR",kindGZIP:"Архив GZIP",kindBZIP:"Архив BZIP",kindZIP:"Архив ZIP",kindRAR:"Архив RAR",kindJAR:"Файл Java JAR",kindTTF:"Шрифт True Type",kindOTF:"Шрифт Open Type",kindRPM:"Пакет RPM",kindText:"Текстовый документ",kindTextPlain:"Простой текст",kindPHP:"Исходник PHP",kindCSS:"Таблицы стилей CSS",kindHTML:"Документ HTML",kindJS:"Исходник Javascript",kindRTF:"Rich Text Format",kindC:"Исходник C",kindCHeader:"Заголовочный файл C",kindCPP:"Исходник C++",kindCPPHeader:"Заголовочный файл C++",kindShell:"Unix shell script",kindPython:"Исходник Python",kindJava:"Исходник Java",kindRuby:"Исходник Ruby",kindPerl:"Исходник Perl",kindSQL:"Исходник SQL",kindXML:"XML document",kindAWK:"Исходник AWK",kindCSV:"Текст с разделителями",kindDOCBOOK:"Документ Docbook XML",kindImage:"Изображение",kindBMP:"Изображение BMP",kindJPEG:"Изображение JPEG",kindGIF:"Изображение GIF",kindPNG:"Изображение PNG",kindTIFF:"Изображение TIFF",kindTGA:"Изображение TGA",kindPSD:"Изображение Adobe Photoshop",kindXBITMAP:"Изображение X bitmap",kindPXM:"Изображение Pixelmator",kindAudio:"Аудио файл",kindAudioMPEG:"Аудио MPEG",kindAudioMPEG4:"Аудио MPEG-4",kindAudioMIDI:"Аудио MIDI",kindAudioOGG:"Аудио Ogg Vorbis",kindAudioWAV:"Аудио WAV",AudioPlaylist:"Плейлист MP3",kindVideo:"Видео файл",kindVideoDV:"Видео DV",kindVideoMPEG:"Видео MPEG",kindVideoMPEG4:"Видео MPEG-4",kindVideoAVI:"Видео AVI",kindVideoMOV:"Видео Quick Time",kindVideoWM:"Видео Windows Media",kindVideoFlash:"Видео Flash",kindVideoMKV:"Видео Matroska",kindVideoOGG:"Видео Ogg",volume_files:"Файлы "}};}elFinder.prototype.version="2.0.2";$.fn.elfinder=function(o){if(o=="instance"){return this.getElFinder();}return this.each(function(){var cmd=typeof(o)=="string"?o:"";if(!this.elfinder){new elFinder(this,typeof(o)=="object"?o:{});}switch(cmd){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy();break;}});};$.fn.getElFinder=function(){var instance;this.each(function(){if(this.elfinder){instance=this.elfinder;return false;}});return instance;};"use strict";elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){var fm=this.fm,cmd=this.name,cwd=fm.getUI("cwd"),dfrd=$.Deferred().fail(function(error){cwd.trigger("unselectall");error&&fm.error(error);}).always(function(){input.remove();node.remove();fm.enable();}),id="tmp_"+parseInt(Math.random()*100000),phash=fm.cwd().hash,date=new Date(),file={hash:id,name:fm.uniqueName(this.prefix),mime:this.mime,read:true,write:true,date:"Today "+date.getHours()+":"+date.getMinutes()},node=cwd.trigger("create."+fm.namespace,file).find("#"+id),input=$('<input type="text"/>').keydown(function(e){e.stopImmediatePropagation();if(e.keyCode==$.ui.keyCode.ESCAPE){dfrd.reject();}else{if(e.keyCode==$.ui.keyCode.ENTER){input.blur();}}}).mousedown(function(e){e.stopPropagation();}).blur(function(){var name=$.trim(input.val()),parent=input.parent();if(parent.length){if(!name){return dfrd.reject("errInvName");}if(fm.fileByName(name,phash)){return dfrd.reject(["errExists",name]);}parent.html(fm.escape(name));fm.lockfiles({files:[id]});fm.request({data:{cmd:cmd,name:name,target:phash},notify:{type:cmd,cnt:1},preventFail:true,syncOnFail:true}).fail(function(error){dfrd.reject(error);}).done(function(data){dfrd.resolve(data);});}});if(this.disabled()||!node.length){return dfrd.reject();}fm.disable();node.find(".elfinder-cwd-filename").empty("").append(input.val(file.name));input.select().focus();input[0].setSelectionRange&&input[0].setSelectionRange(0,file.name.replace(/\..+$/,"").length);return dfrd;}}};elFinder.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",iframeTimeout:0,customData:{},handlers:{},lang:"en",cssClass:"",commands:["open","reload","home","up","back","forward","quicklook","download","rm","duplicate","rename","mkdir","mkfile","upload","copy","cut","paste","edit","info","view","resize","sort"],commandsOptions:{getfile:{onlyURL:false,multiple:false,folders:false,oncomplete:""},upload:{ui:"uploadbutton"},edit:{mimes:[],editors:[]},info:{nullUrlDirLinkSelf:true},help:{view:["about","shortcuts","help"]}},getFileCallback:null,defaultView:"icons",ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit","resize"],["extract","archive"],["search"],["view","sort"],["help"]],tree:{openRootOnLoad:true,syncTree:true},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:false}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:true,clientFormatDate:true,UTCDate:false,dateFormat:"",fancyDateFormat:"",width:"auto",height:400,resizable:true,notifyDelay:500,allowShortcuts:true,rememberLastDir:true,useBrowserHistory:true,showFiles:30,showThreshold:50,validName:false,sync:0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:false},contextmenu:{navbar:["open","|","copy","cut","paste","duplicate","|","rm","|","info"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","sort","|","info"],files:["getfile","|","open","quicklook","|","download","|","copy","cut","paste","duplicate","|","rm","|","edit","rename","resize","|","archive","extract","|","info"]},debug:["error","warning","event-destroy"]};elFinder.prototype.history=function(fm){var self=this,update=true,history=[],current,reset=function(){history=[fm.cwd().hash];current=0;update=true;},nativeHistory=(fm.options.useBrowserHistory&&window.history&&window.history.pushState)?window.history:null,go=function(fwd){if((fwd&&self.canForward())||(!fwd&&self.canBack())){update=false;return fm.exec("open",history[fwd?++current:--current]).fail(reset);}return $.Deferred().reject();};this.canBack=function(){return current>0;};this.canForward=function(){return current<history.length-1;};this.back=go;this.forward=function(){return go(true);};fm.open(function(e){var l=history.length,cwd=fm.cwd().hash;if(update){current>=0&&l>current+1&&history.splice(current+1);history[history.length-1]!=cwd&&history.push(cwd);current=history.length-1;}update=true;if(nativeHistory){if(!nativeHistory.state){nativeHistory.replaceState({thash:cwd},null,location.pathname+location.search+"#elf_"+cwd);}else{nativeHistory.state.thash!=cwd&&nativeHistory.pushState({thash:cwd},null,location.pathname+location.search+"#elf_"+cwd);}}}).reload(reset);};elFinder.prototype.command=function(fm){this.fm=fm;this.name="";this.title="";this.state=-1;this.alwaysEnabled=false;this._disabled=false;this.disableOnSearch=false;this.updateOnSelect=true;this._handlers={enable:function(){this.update(void (0),this.value);},disable:function(){this.update(-1,this.value);},"open reload load":function(e){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void (0),this.value);this.change();}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.setup=function(name,opts){var self=this,fm=this.fm,i,s;this.name=name;this.title=fm.messages["cmd"+name]?fm.i18n("cmd"+name):name,this.options=$.extend({},this.options,opts);this.listeners=[];if(this.updateOnSelect){this._handlers.select=function(){this.update(void (0),this.value);};}$.each($.extend({},self._handlers,self.handlers),function(cmd,handler){fm.bind(cmd,$.proxy(handler,self));});for(i=0;i<this.shortcuts.length;i++){s=this.shortcuts[i];s.callback=$.proxy(s.callback||function(){this.exec();},this);!s.description&&(s.description=this.title);fm.shortcut(s);}if(this.disableOnSearch){fm.bind("search searchend",function(e){self._disabled=e.type=="search";self.update(void (0),self.value);});}this.init();};this.init=function(){};this.exec=function(files,opts){return $.Deferred().reject();};this.disabled=function(){return this.state<0;};this.enabled=function(){return this.state>-1;};this.active=function(){return this.state>0;};this.getstate=function(){return -1;};this.update=function(s,v){var state=this.state,value=this.value;if(this._disabled){this.state=-1;}else{this.state=s!==void (0)?s:this.getstate();}this.value=v;if(state!=this.state||value!=this.value){this.change();}};this.change=function(c){var cmd,i;if(typeof(c)==="function"){this.listeners.push(c);}else{for(i=0;i<this.listeners.length;i++){cmd=this.listeners[i];try{cmd(this.state,this.value);}catch(e){this.fm.debug("error",e);}}}return this;};this.hashes=function(hashes){return hashes?$.map($.isArray(hashes)?hashes:[hashes],function(hash){return fm.file(hash)?hash:null;}):fm.selected();};this.files=function(hashes){var fm=this.fm;return hashes?$.map($.isArray(hashes)?hashes:[hashes],function(hash){return fm.file(hash)||null;}):fm.selectedFiles();};};$.fn.elfinderoverlay=function(opts){this.filter(":not(.elfinder-overlay)").each(function(){opts=$.extend({},opts);$(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(e){e.preventDefault();e.stopPropagation();}).data({cnt:0,show:typeof(opts.show)=="function"?opts.show:function(){},hide:typeof(opts.hide)=="function"?opts.hide:function(){}});});if(opts=="show"){var o=this.eq(0),cnt=o.data("cnt")+1,show=o.data("show");o.data("cnt",cnt);if(o.is(":hidden")){o.zIndex(o.parent().zIndex()+1);o.show();show();}}if(opts=="hide"){var o=this.eq(0),cnt=o.data("cnt")-1,hide=o.data("hide");o.data("cnt",cnt);if(cnt==0&&o.is(":visible")){o.hide();hide();}}return this;};"use strict";$.fn.elfinderworkzone=function(fm){var cl="elfinder-workzone";this.not("."+cl).each(function(){var wz=$(this).addClass(cl),wdelta=wz.outerHeight(true)-wz.height(),parent=wz.parent();parent.add(window).bind("resize",function(){var height=parent.height();parent.children(":visible:not(."+cl+")").each(function(){var ch=$(this);if(ch.css("position")!="absolute"){height-=ch.outerHeight(true);}});wz.height(height-wdelta);});});return this;};$.fn.elfindernavbar=function(fm,opts){this.not(".elfinder-navbar").each(function(){var nav=$(this).addClass("ui-state-default elfinder-navbar"),parent=nav.parent().resize(function(){nav.height(wz.height()-delta);}),wz=parent.children(".elfinder-workzone").append(nav),delta=nav.outerHeight()-nav.height(),ltr=fm.direction=="ltr",handle;if($.fn.resizable){handle=nav.resizable({handles:ltr?"e":"w",minWidth:opts.minWidth||150,maxWidth:opts.maxWidth||500}).bind("resize scroll",function(){var offset=(fm.UA.Opera&&nav.scrollLeft())?20:2;handle.css({top:parseInt(nav.scrollTop())+"px",left:ltr?"auto":parseInt(nav.scrollLeft()+offset),right:ltr?parseInt(nav.scrollLeft()-offset)*-1:"auto"});}).find(".ui-resizable-handle").zIndex(nav.zIndex()+10);if(!ltr){nav.resize(function(){nav.css("left",null).css("right",0);});}fm.one("open",function(){setTimeout(function(){nav.trigger("resize");},150);});}});return this;};"use strict";$.fn.elfinderdialog=function(opts){var dialog;if(typeof(opts)=="string"&&(dialog=this.closest(".ui-dialog")).length){if(opts=="open"){dialog.css("display")=="none"&&dialog.fadeIn(120,function(){dialog.trigger("open");});}else{if(opts=="close"){dialog.css("display")!="none"&&dialog.hide().trigger("close");}else{if(opts=="destroy"){dialog.hide().remove();}else{if(opts=="toTop"){dialog.trigger("totop");}}}}}opts=$.extend({},$.fn.elfinderdialog.defaults,opts);this.filter(":not(.ui-dialog-content)").each(function(){var self=$(this).addClass("ui-dialog-content ui-widget-content"),parent=self.parent(),clactive="elfinder-dialog-active",cldialog="elfinder-dialog",clnotify="elfinder-dialog-notify",clhover="ui-state-hover",id=parseInt(Math.random()*1000000),overlay=parent.children(".elfinder-overlay"),buttonset=$('<div class="ui-dialog-buttonset"/>'),buttonpane=$('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(buttonset),dialog=$('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  '+cldialog+" "+opts.cssClass+'"/>').hide().append(self).appendTo(parent).draggable({handle:".ui-dialog-titlebar",containment:"document"}).css({width:opts.width,height:opts.height}).mousedown(function(e){e.stopPropagation();$(document).mousedown();if(!dialog.is("."+clactive)){parent.find("."+cldialog+":visible").removeClass(clactive);dialog.addClass(clactive).zIndex(maxZIndex()+1);}}).bind("open",function(){dialog.trigger("totop");typeof(opts.open)=="function"&&$.proxy(opts.open,self[0])();if(!dialog.is("."+clnotify)){parent.find("."+cldialog+":visible").not("."+clnotify).each(function(){var d=$(this),top=parseInt(d.css("top")),left=parseInt(d.css("left")),_top=parseInt(dialog.css("top")),_left=parseInt(dialog.css("left"));if(d[0]!=dialog[0]&&(top==_top||left==_left)){dialog.css({top:(top+10)+"px",left:(left+10)+"px"});}});}}).bind("close",function(){var dialogs=parent.find(".elfinder-dialog:visible"),z=maxZIndex();$(this).data("modal")&&overlay.elfinderoverlay("hide");if(dialogs.length){dialogs.each(function(){var d=$(this);if(d.zIndex()>=z){d.trigger("totop");return false;}});}else{setTimeout(function(){parent.mousedown().click();},10);}if(typeof(opts.close)=="function"){$.proxy(opts.close,self[0])();}else{if(opts.destroyOnClose){dialog.hide().remove();}}}).bind("totop",function(){$(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus();$(this).data("modal")&&overlay.elfinderoverlay("show");overlay.zIndex($(this).zIndex());}).data({modal:opts.modal}),maxZIndex=function(){var z=parent.zIndex()+10;parent.find("."+cldialog+":visible").each(function(){var _z;if(this!=dialog[0]){_z=$(this).zIndex();if(_z>z){z=_z;}}});return z;},top;if(!opts.position){top=parseInt((parent.height()-dialog.outerHeight())/2-42);opts.position={top:(top>0?top:0)+"px",left:parseInt((parent.width()-dialog.outerWidth())/2)+"px"};}dialog.css(opts.position);if(opts.closeOnEscape){$(document).bind("keyup."+id,function(e){if(e.keyCode==$.ui.keyCode.ESCAPE&&dialog.is("."+clactive)){self.elfinderdialog("close");$(document).unbind("keyup."+id);}});}dialog.prepend($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+opts.title+"</div>").prepend($('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(e){e.preventDefault();self.elfinderdialog("close");})));$.each(opts.buttons,function(name,cb){var button=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+name+"</span></button>").click($.proxy(cb,self[0])).hover(function(e){$(this)[e.type=="mouseenter"?"focus":"blur"]();}).focus(function(){$(this).addClass(clhover);}).blur(function(){$(this).removeClass(clhover);}).keydown(function(e){var next;if(e.keyCode==$.ui.keyCode.ENTER){$(this).click();}else{if(e.keyCode==$.ui.keyCode.TAB){next=$(this).next(".ui-button");next.length?next.focus():$(this).parent().children(".ui-button:first").focus();}}});buttonset.append(button);});buttonset.children().length&&dialog.append(buttonpane);if(opts.resizable&&$.fn.resizable){dialog.resizable({minWidth:opts.minWidth,minHeight:opts.minHeight,alsoResize:this});}typeof(opts.create)=="function"&&$.proxy(opts.create,this)();opts.autoOpen&&self.elfinderdialog("open");});return this;};$.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:false,resizable:true,autoOpen:true,closeOnEscape:true,destroyOnClose:false,buttons:{},position:null,width:320,height:"auto",minWidth:200,minHeight:110};"use strict";$.fn.elfindertree=function(fm,opts){var treeclass=fm.res("class","tree");this.not("."+treeclass).each(function(){var c="class",root=fm.res(c,"treeroot"),openRoot=opts.openRootOnLoad,subtree=fm.res(c,"navsubtree"),navdir=fm.res(c,"treedir"),collapsed=fm.res(c,"navcollapse"),expanded=fm.res(c,"navexpand"),loaded="elfinder-subtree-loaded",arrow=fm.res(c,"navarrow"),active=fm.res(c,"active"),dropover=fm.res(c,"adroppable"),hover=fm.res(c,"hover"),disabled=fm.res(c,"disabled"),draggable=fm.res(c,"draggable"),droppable=fm.res(c,"droppable"),insideNavbar=function(x){var left=navbar.offset().left;return left<=x&&x<=left+navbar.width();},drop=fm.droppable.drop,droppableopts=$.extend(true,{},fm.droppable,{over:function(e){var link=$(this),cl=hover+" "+dropover;if(insideNavbar(e.clientX)){link.addClass(cl);if(link.is("."+collapsed+":not(."+expanded+")")){setTimeout(function(){link.is("."+dropover)&&link.children("."+arrow).click();},500);}}else{link.removeClass(cl);}},out:function(){$(this).removeClass(hover+" "+dropover);},drop:function(e,ui){insideNavbar(e.clientX)&&drop.call(this,e,ui);}}),spinner=$(fm.res("tpl","navspinner")),tpl=fm.res("tpl","navdir"),ptpl=fm.res("tpl","perms"),stpl=fm.res("tpl","symlink"),replace={id:function(dir){return fm.navHash2Id(dir.hash);},cssclass:function(dir){return(dir.phash?"":root)+" "+navdir+" "+fm.perms2class(dir)+" "+(dir.dirs&&!dir.link?collapsed:"");},permissions:function(dir){return !dir.read||!dir.write?ptpl:"";},symlink:function(dir){return dir.alias?stpl:"";}},itemhtml=function(dir){dir.name=fm.escape(dir.i18||dir.name);return tpl.replace(/(?:\{([a-z]+)\})/ig,function(m,key){return dir[key]||(replace[key]?replace[key](dir):"");});},filter=function(files){return $.map(files||[],function(f){return f.mime=="directory"?f:null;});},findSubtree=function(hash){return hash?tree.find("#"+fm.navHash2Id(hash)).next("."+subtree):tree;},findSibling=function(subtree,dir){var node=subtree.children(":first"),info;while(node.length){info=fm.file(fm.navId2Hash(node.children("[id]").attr("id")));if((info=fm.file(fm.navId2Hash(node.children("[id]").attr("id"))))&&dir.name.toLowerCase().localeCompare(info.name.toLowerCase())<0){return node;}node=node.next();}return $("");},updateTree=function(dirs){var length=dirs.length,orphans=[],i=dirs.length,dir,html,parent,sibling;var firstVol=true;while(i--){dir=dirs[i];if(tree.find("#"+fm.navHash2Id(dir.hash)).length){continue;}if((parent=findSubtree(dir.phash)).length){html=itemhtml(dir);if(dir.phash&&(sibling=findSibling(parent,dir)).length){sibling.before(html);}else{parent[firstVol||dir.phash?"append":"prepend"](html);firstVol=false;}}else{orphans.push(dir);}}if(orphans.length&&orphans.length<length){return updateTree(orphans);}setTimeout(function(){updateDroppable();},10);},sync=function(stopRec){var cwd=fm.cwd().hash,current=tree.find("#"+fm.navHash2Id(cwd)),rootNode,dir;if(openRoot){rootNode=tree.find("#"+fm.navHash2Id(fm.root()));rootNode.is("."+loaded)&&rootNode.addClass(expanded).next("."+subtree).show();openRoot=false;}if(!current.is("."+active)){tree.find("."+navdir+"."+active).removeClass(active);current.addClass(active);}if(opts.syncTree){if(current.length){return current.parentsUntil("."+root).filter("."+subtree).show().prev("."+navdir).addClass(expanded);}if(fm.newAPI){dir=fm.file(cwd);if(dir&&dir.phash&&tree.find("#"+fm.navHash2Id(dir.phash)).length){updateTree([dir]);return sync();}fm.request({data:{cmd:"parents",target:cwd},preventFail:true}).done(function(data){var dirs=filter(data.tree);updateTree(dirs);updateArrows(dirs,loaded);cwd==fm.cwd().hash&&sync(true);});}}},updateDroppable=function(){tree.find("."+navdir+":not(."+droppable+",.elfinder-ro,.elfinder-na)").droppable(droppableopts);},updateArrows=function(dirs,cls){var sel=cls==loaded?"."+collapsed+":not(."+loaded+")":":not(."+collapsed+")";$.each(dirs,function(i,dir){tree.find("#"+fm.navHash2Id(dir.phash)+sel).filter(function(){return $(this).next("."+subtree).children().length>0;}).addClass(cls);});},tree=$(this).addClass(treeclass).delegate("."+navdir,"hover",function(e){var link=$(this),enter=e.type=="mouseenter";if(!link.is("."+dropover+" ,."+disabled)){enter&&!link.is("."+root+",."+draggable+",.elfinder-na,.elfinder-wo")&&link.draggable(fm.draggable);link.toggleClass(hover,enter);}}).delegate("."+navdir,"dropover dropout drop",function(e){$(this)[e.type=="dropover"?"addClass":"removeClass"](dropover+" "+hover);}).delegate("."+navdir,"click",function(e){var link=$(this),hash=fm.navId2Hash(link.attr("id")),file=fm.file(hash);fm.trigger("searchend");if(hash!=fm.cwd().hash&&!link.is("."+disabled)){fm.exec("open",file.thash||hash);}else{if(link.is("."+collapsed)){link.children("."+arrow).click();}}}).delegate("."+navdir+"."+collapsed+" ."+arrow,"click",function(e){var arrow=$(this),link=arrow.parent("."+navdir),stree=link.next("."+subtree);e.stopPropagation();if(link.is("."+loaded)){link.toggleClass(expanded);stree.slideToggle();}else{spinner.insertBefore(arrow);link.removeClass(collapsed);fm.request({cmd:"tree",target:fm.navId2Hash(link.attr("id"))}).done(function(data){updateTree(filter(data.tree));if(stree.children().length){link.addClass(collapsed+" "+expanded);stree.slideDown();}sync();}).always(function(data){spinner.remove();link.addClass(loaded);});}}).delegate("."+navdir,"contextmenu",function(e){e.preventDefault();fm.trigger("contextmenu",{type:"navbar",targets:[fm.navId2Hash($(this).attr("id"))],x:e.clientX,y:e.clientY});}),navbar=fm.getUI("navbar").append(tree).show();fm.open(function(e){var data=e.data,dirs=filter(data.files);data.init&&tree.empty();if(dirs.length){updateTree(dirs);updateArrows(dirs,loaded);}sync();}).add(function(e){var dirs=filter(e.data.added);if(dirs.length){updateTree(dirs);updateArrows(dirs,collapsed);}}).change(function(e){var dirs=filter(e.data.changed),l=dirs.length,dir,node,tmp,realParent,reqParent,realSibling,reqSibling,isExpanded,isLoaded;while(l--){dir=dirs[l];if((node=tree.find("#"+fm.navHash2Id(dir.hash))).length){if(dir.phash){realParent=node.closest("."+subtree);reqParent=findSubtree(dir.phash);realSibling=node.parent().next();reqSibling=findSibling(reqParent,dir);if(!reqParent.length){continue;}if(reqParent[0]!==realParent[0]||realSibling.get(0)!==reqSibling.get(0)){reqSibling.length?reqSibling.before(node):reqParent.append(node);}}isExpanded=node.is("."+expanded);isLoaded=node.is("."+loaded);tmp=$(itemhtml(dir));node.replaceWith(tmp.children("."+navdir));if(dir.dirs&&(isExpanded||isLoaded)&&(node=tree.find("#"+fm.navHash2Id(dir.hash)))&&node.next("."+subtree).children().length){isExpanded&&node.addClass(expanded);isLoaded&&node.addClass(loaded);}}}sync();updateDroppable();}).remove(function(e){var dirs=e.data.removed,l=dirs.length,node,stree;while(l--){if((node=tree.find("#"+fm.navHash2Id(dirs[l]))).length){stree=node.closest("."+subtree);node.parent().detach();if(!stree.children().length){stree.hide().prev("."+navdir).removeClass(collapsed+" "+expanded+" "+loaded);}}}}).bind("search searchend",function(e){tree.find("#"+fm.navHash2Id(fm.cwd().hash))[e.type=="search"?"removeClass":"addClass"](active);}).bind("lockfiles unlockfiles",function(e){var lock=e.type=="lockfiles",act=lock?"disable":"enable",dirs=$.map(e.data.files||[],function(h){var dir=fm.file(h);return dir&&dir.mime=="directory"?h:null;});$.each(dirs,function(i,hash){var dir=tree.find("#"+fm.navHash2Id(hash));if(dir.length){dir.is("."+draggable)&&dir.draggable(act);dir.is("."+droppable)&&dir.droppable(active);dir[lock?"addClass":"removeClass"](disabled);}});});});return this;};"use strict";$.fn.elfindercwd=function(fm,options){this.not(".elfinder-cwd").each(function(){var list=fm.viewType=="list",undef="undefined",evtSelect="select."+fm.namespace,evtUnselect="unselect."+fm.namespace,evtDisable="disable."+fm.namespace,evtEnable="enable."+fm.namespace,c="class",clFile=fm.res(c,"cwdfile"),fileSelector="."+clFile,clSelected="ui-selected",clDisabled=fm.res(c,"disabled"),clDraggable=fm.res(c,"draggable"),clDroppable=fm.res(c,"droppable"),clHover=fm.res(c,"hover"),clDropActive=fm.res(c,"adroppable"),clTmp=clFile+"-tmp",tmbNum=fm.options.loadTmbs>0?fm.options.loadTmbs:5,query="",lastSearch=[],templates={icon:'<div id="{hash}" class="'+clFile+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+clFile+' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},permsTpl=fm.res("tpl","perms"),symlinkTpl=fm.res("tpl","symlink"),replacement={permsclass:function(f){return fm.perms2class(f);},perms:function(f){return fm.formatPermissions(f);},dirclass:function(f){return f.mime=="directory"?"directory":"";},mime:function(f){return fm.mime2class(f.mime);},size:function(f){return fm.formatSize(f.size);},date:function(f){return fm.formatDate(f);},kind:function(f){return fm.mime2kind(f);},marker:function(f){return(f.alias||f.mime=="symlink-broken"?symlinkTpl:"")+(!f.read||!f.write?permsTpl:"");},tooltip:function(f){var title=fm.formatDate(f)+(f.size>0?" ("+fm.formatSize(f.size)+")":"");return f.tooltip?fm.escape(f.tooltip).replace(/"/g,"&quot;").replace(/\r/g,"&#13;")+"&#13;"+title:title;}},itemhtml=function(f){f.name=fm.escape(f.name);return templates[list?"row":"icon"].replace(/\{([a-z]+)\}/g,function(s,e){return replacement[e]?replacement[e](f):(f[e]?f[e]:"");});},selectLock=false,select=function(keyCode,append){var code=$.ui.keyCode,prev=keyCode==code.LEFT||keyCode==code.UP,sel=cwd.find("[id]."+clSelected),selector=prev?"first:":"last",s,n,sib,top,left;function sibling(n,direction){return n[direction+"All"]("[id]:not(."+clDisabled+"):not(.elfinder-cwd-parent):first");}if(sel.length){s=sel.filter(prev?":first":":last");sib=sibling(s,prev?"prev":"next");if(!sib.length){n=s;}else{if(list||keyCode==code.LEFT||keyCode==code.RIGHT){n=sib;}else{top=s.position().top;left=s.position().left;n=s;if(prev){do{n=n.prev("[id]");}while(n.length&&!(n.position().top<top&&n.position().left<=left));if(n.is("."+clDisabled)){n=sibling(n,"next");}}else{do{n=n.next("[id]");}while(n.length&&!(n.position().top>top&&n.position().left>=left));if(n.is("."+clDisabled)){n=sibling(n,"prev");}if(!n.length){sib=cwd.find("[id]:not(."+clDisabled+"):last");if(sib.position().top>top){n=sib;}}}}}}else{n=cwd.find("[id]:not(."+clDisabled+"):not(.elfinder-cwd-parent):"+(prev?"last":"first"));}if(n&&n.length&&!n.is(".elfinder-cwd-parent")){if(append){n=s.add(s[prev?"prevUntil":"nextUntil"]("#"+n.attr("id"))).add(n);}else{sel.trigger(evtUnselect);}n.trigger(evtSelect);scrollToView(n.filter(prev?":first":":last"));trigger();}},selectedFiles=[],selectFile=function(hash){cwd.find("#"+hash).trigger(evtSelect);},selectAll=function(){var phash=fm.cwd().hash;cwd.find("[id]:not(."+clSelected+"):not(.elfinder-cwd-parent)").trigger(evtSelect);selectedFiles=$.map(fm.files(),function(f){return f.phash==phash?f.hash:null;});trigger();},unselectAll=function(){selectedFiles=[];cwd.find("[id]."+clSelected).trigger(evtUnselect);trigger();},selected=function(){return selectedFiles;},trigger=function(){fm.trigger("select",{selected:selectedFiles});},scrollToView=function(o){var ftop=o.position().top,fheight=o.outerHeight(true),wtop=wrapper.scrollTop(),wheight=wrapper.innerHeight();if(ftop+fheight>wtop+wheight){wrapper.scrollTop(parseInt(ftop+fheight-wheight));}else{if(ftop<wtop){wrapper.scrollTop(ftop);}}},buffer=[],index=function(hash){var l=buffer.length;while(l--){if(buffer[l].hash==hash){return l;}}return -1;},scrollEvent="scroll."+fm.namespace,render=function(){var html=[],dirs=false,ltmb=[],atmb={},last=cwd.find("[id]:last"),top=!last.length,place=list?cwd.children("table").children("tbody"):cwd,files;if(!buffer.length){return wrapper.unbind(scrollEvent);}while((!last.length||last.position().top<=wrapper.height()+wrapper.scrollTop()+fm.options.showThreshold)&&(files=buffer.splice(0,fm.options.showFiles)).length){html=$.map(files,function(f){if(f.hash&&f.name){if(f.mime=="directory"){dirs=true;}if(f.tmb){f.tmb===1?ltmb.push(f.hash):(atmb[f.hash]=f.tmb);}return itemhtml(f);}return null;});place.append(html.join(""));last=cwd.find("[id]:last");top&&cwd.scrollTop(0);}attachThumbnails(atmb);ltmb.length&&loadThumbnails(ltmb);dirs&&makeDroppable();if(selectedFiles.length){place.find("[id]:not(."+clSelected+"):not(.elfinder-cwd-parent)").each(function(){var id=this.id;$.inArray(id,selectedFiles)!==-1&&$(this).trigger(evtSelect);});}},droppable=$.extend({},fm.droppable,{over:function(e,ui){var hash=fm.cwd().hash;$.each(ui.helper.data("files"),function(i,h){if(fm.file(h).phash==hash){cwd.removeClass(clDropActive);return false;}});}}),makeDroppable=function(){setTimeout(function(){cwd.find(".directory:not(."+clDroppable+",.elfinder-na,.elfinder-ro)").droppable(fm.droppable);},20);},attachThumbnails=function(images){var url=fm.option("tmbUrl"),ret=true,ndx;$.each(images,function(hash,tmb){var node=cwd.find("#"+hash);if(node.length){(function(node,tmb){$("<img/>").load(function(){node.find(".elfinder-cwd-icon").css("background","url('"+tmb+"') center center no-repeat");}).attr("src",tmb);})(node,url+tmb);}else{ret=false;if((ndx=index(hash))!=-1){buffer[ndx].tmb=tmb;}}});return ret;},loadThumbnails=function(files){var tmbs=[];if(fm.oldAPI){fm.request({data:{cmd:"tmb",current:fm.cwd().hash},preventFail:true}).done(function(data){if(attachThumbnails(data.images||[])&&data.tmb){loadThumbnails();}});return;}tmbs=tmbs=files.splice(0,tmbNum);if(tmbs.length){fm.request({data:{cmd:"tmb",targets:tmbs},preventFail:true}).done(function(data){if(attachThumbnails(data.images||[])){loadThumbnails(files);}});}},add=function(files){var place=list?cwd.find("tbody"):cwd,l=files.length,ltmb=[],atmb={},dirs=false,findNode=function(file){var pointer=cwd.find("[id]:first"),file2;while(pointer.length){file2=fm.file(pointer.attr("id"));if(!pointer.is(".elfinder-cwd-parent")&&file2&&fm.compare(file,file2)<0){return pointer;}pointer=pointer.next("[id]");}},findIndex=function(file){var l=buffer.length,i;for(i=0;i<l;i++){if(fm.compare(file,buffer[i])<0){return i;}}return l||-1;},file,hash,node,ndx;while(l--){file=files[l];hash=file.hash;if(cwd.find("#"+hash).length){continue;}if((node=findNode(file))&&node.length){node.before(itemhtml(file));}else{if((ndx=findIndex(file))>=0){buffer.splice(ndx,0,file);}else{place.append(itemhtml(file));}}if(cwd.find("#"+hash).length){if(file.mime=="directory"){dirs=true;}else{if(file.tmb){file.tmb===1?ltmb.push(hash):(atmb[hash]=file.tmb);}}}}attachThumbnails(atmb);ltmb.length&&loadThumbnails(ltmb);dirs&&makeDroppable();},remove=function(files){var l=files.length,hash,n,ndx;while(l--){hash=files[l];if((n=cwd.find("#"+hash)).length){try{n.detach();}catch(e){fm.debug("error",e);}}else{if((ndx=index(hash))!=-1){buffer.splice(ndx,1);}}}},msg={name:fm.i18n("name"),perm:fm.i18n("perms"),mod:fm.i18n("modify"),size:fm.i18n("size"),kind:fm.i18n("kind")},content=function(files,any){var phash=fm.cwd().hash;unselectAll();try{cwd.children("table,"+fileSelector).remove();}catch(e){cwd.html("");}cwd.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(list?"list":"icons"));wrapper[list?"addClass":"removeClass"]("elfinder-cwd-wrapper-list");list&&cwd.html('<table><thead><tr class="ui-state-default"><td >'+msg.name+"</td><td>"+msg.perm+"</td><td>"+msg.mod+"</td><td>"+msg.size+"</td><td>"+msg.kind+"</td></tr></thead><tbody/></table>");buffer=$.map(files,function(f){return any||f.phash==phash?f:null;});buffer=fm.sortFiles(buffer);wrapper.bind(scrollEvent,render).trigger(scrollEvent);phash=fm.cwd().phash;if(options.oldSchool&&phash&&!query){var parent=$.extend(true,{},fm.file(phash),{name:"..",mime:"directory"});parent=$(itemhtml(parent)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup touchstart touchmove touchend dblclick mouseenter",function(e){e.preventDefault();e.stopPropagation();}).dblclick(function(){fm.exec("open",this.id);});(list?cwd.find("tbody"):cwd).prepend(parent);}},cwd=$(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").delegate(fileSelector,"click."+fm.namespace,function(e){var p=this.id?$(this):$(this).parents("[id]:first"),prev=p.prevAll("."+clSelected+":first"),next=p.nextAll("."+clSelected+":first"),pl=prev.length,nl=next.length,sib;e.stopImmediatePropagation();if(e.shiftKey&&(pl||nl)){sib=pl?p.prevUntil("#"+prev.attr("id")):p.nextUntil("#"+next.attr("id"));sib.add(p).trigger(evtSelect);}else{if(e.ctrlKey||e.metaKey){p.trigger(p.is("."+clSelected)?evtUnselect:evtSelect);}else{if($(this).data("touching")&&p.is("."+clSelected)){$(this).data("touching",null);fm.dblclick({file:this.id});unselectAll();}else{unselectAll();p.trigger(evtSelect);}}}trigger();}).delegate(fileSelector,"dblclick."+fm.namespace,function(e){fm.dblclick({file:this.id});}).delegate(fileSelector,"touchstart."+fm.namespace,function(e){$(this).data("touching",true);var p=this.id?$(this):$(this).parents("[id]:first"),sel=p.prevAll("."+clSelected+":first").length+p.nextAll("."+clSelected+":first").length;$(this).data("longtap",setTimeout(function(){p.trigger(p.is("."+clSelected)?evtUnselect:evtSelect);trigger();if(sel==0&&p.is("."+clSelected)){p.trigger("click");trigger();}},500));}).delegate(fileSelector,"touchmove."+fm.namespace+" touchend."+fm.namespace,function(e){clearTimeout($(this).data("longtap"));}).delegate(fileSelector,"mouseenter."+fm.namespace,function(e){var $this=$(this),target=list?$this:$this.children();if(!$this.is("."+clTmp)&&!target.is("."+clDraggable+",."+clDisabled)){target.draggable(fm.draggable);}}).delegate(fileSelector,evtSelect,function(e){var $this=$(this),id=$this.attr("id");if(!selectLock&&!$this.is("."+clDisabled)){$this.addClass(clSelected).children().addClass(clHover);if($.inArray(id,selectedFiles)===-1){selectedFiles.push(id);}}}).delegate(fileSelector,evtUnselect,function(e){var $this=$(this),id=$this.attr("id"),ndx;if(!selectLock){$(this).removeClass(clSelected).children().removeClass(clHover);ndx=$.inArray(id,selectedFiles);if(ndx!==-1){selectedFiles.splice(ndx,1);}}}).delegate(fileSelector,evtDisable,function(){var $this=$(this).removeClass(clSelected).addClass(clDisabled),target=(list?$this:$this.children()).removeClass(clHover);$this.is("."+clDroppable)&&$this.droppable("disable");target.is("."+clDraggable)&&target.draggable("disable");!list&&target.removeClass(clDisabled);}).delegate(fileSelector,evtEnable,function(){var $this=$(this).removeClass(clDisabled),target=list?$this:$this.children();$this.is("."+clDroppable)&&$this.droppable("enable");target.is("."+clDraggable)&&target.draggable("enable");}).delegate(fileSelector,"scrolltoview",function(){scrollToView($(this));}).delegate(fileSelector,"mouseenter."+fm.namespace+" mouseleave."+fm.namespace,function(e){fm.trigger("hover",{hash:$(this).attr("id"),type:e.type});$(this).toggleClass("ui-state-hover");}).bind("contextmenu."+fm.namespace,function(e){var file=$(e.target).closest("."+clFile);if(file.length){e.stopPropagation();e.preventDefault();if(!file.is("."+clDisabled)){if(!file.is("."+clSelected)){unselectAll();file.trigger(evtSelect);trigger();}fm.trigger("contextmenu",{type:"files",targets:fm.selected(),x:e.clientX,y:e.clientY});}}}).bind("click."+fm.namespace,function(e){!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&unselectAll();}).selectable({filter:fileSelector,stop:trigger,delay:250,selected:function(e,ui){$(ui.selected).trigger(evtSelect);},unselected:function(e,ui){$(ui.unselected).trigger(evtUnselect);}}).droppable(droppable).bind("create."+fm.namespace,function(e,file){var parent=list?cwd.find("tbody"):cwd,p=parent.find(".elfinder-cwd-parent"),file=$(itemhtml(file)).addClass(clTmp);unselectAll();if(p.length){p.after(file);}else{parent.prepend(file);}cwd.scrollTop(0);}).bind("unselectall",unselectAll).bind("selectfile",function(e,id){cwd.find("#"+id).trigger(evtSelect);trigger();}),wrapper=$('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu",function(e){e.preventDefault();fm.trigger("contextmenu",{type:"cwd",targets:[fm.cwd().hash],x:e.clientX,y:e.clientY});}),resize=function(){var h=0;wrapper.siblings(".elfinder-panel:visible").each(function(){h+=$(this).outerHeight(true);});wrapper.height(wz.height()-h);},parent=$(this).parent().resize(resize),wz=parent.children(".elfinder-workzone").append(wrapper.append(this));if(fm.dragUpload){wrapper[0].addEventListener("dragenter",function(e){e.preventDefault();e.stopPropagation();wrapper.addClass(clDropActive);},false);wrapper[0].addEventListener("dragleave",function(e){e.preventDefault();e.stopPropagation();e.target==cwd[0]&&wrapper.removeClass(clDropActive);},false);wrapper[0].addEventListener("dragover",function(e){e.preventDefault();e.stopPropagation();},false);wrapper[0].addEventListener("drop",function(e){e.preventDefault();wrapper.removeClass(clDropActive);e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&fm.exec("upload",{files:e.dataTransfer.files});},false);}fm.bind("open",function(e){content(e.data.files);}).bind("search",function(e){lastSearch=e.data.files;content(lastSearch,true);}).bind("searchend",function(){lastSearch=[];if(query){query="";content(fm.files());}}).bind("searchstart",function(e){query=e.data.query;}).bind("sortchange",function(){content(query?lastSearch:fm.files(),!!query);}).bind("viewchange",function(){var sel=fm.selected(),l=fm.storage("view")=="list";if(l!=list){list=l;content(fm.files());$.each(sel,function(i,h){selectFile(h);});trigger();}resize();}).add(function(e){var phash=fm.cwd().hash,files=query?$.map(e.data.added||[],function(f){return f.name.indexOf(query)===-1?null:f;}):$.map(e.data.added||[],function(f){return f.phash==phash?f:null;});add(files);}).change(function(e){var phash=fm.cwd().hash,sel=fm.selected(),files;if(query){$.each(e.data.changed||[],function(i,file){remove([file.hash]);if(file.name.indexOf(query)!==-1){add([file]);$.inArray(file.hash,sel)!==-1&&selectFile(file.hash);}});}else{$.each($.map(e.data.changed||[],function(f){return f.phash==phash?f:null;}),function(i,file){remove([file.hash]);add([file]);$.inArray(file.hash,sel)!==-1&&selectFile(file.hash);});}trigger();}).remove(function(e){remove(e.data.removed||[]);trigger();}).bind("open add search searchend",function(){cwd.css("height","auto");if(cwd.outerHeight(true)<wrapper.height()){cwd.height(wrapper.height()-(cwd.outerHeight(true)-cwd.height())-2);}}).dragstart(function(e){var target=$(e.data.target),oe=e.data.originalEvent;if(target.is(fileSelector)){if(!target.is("."+clSelected)){!(oe.ctrlKey||oe.metaKey||oe.shiftKey)&&unselectAll();target.trigger(evtSelect);trigger();}cwd.droppable("disable");}cwd.selectable("disable").removeClass(clDisabled);selectLock=true;}).dragstop(function(){cwd.selectable("enable").droppable("enable");selectLock=false;}).bind("lockfiles unlockfiles",function(e){var event=e.type=="lockfiles"?evtDisable:evtEnable,files=e.data.files||[],l=files.length;while(l--){cwd.find("#"+files[l]).trigger(event);}trigger();}).bind("mkdir mkfile duplicate upload rename archive extract",function(e){var phash=fm.cwd().hash,files;unselectAll();$.each(e.data.added||[],function(i,file){file&&file.phash==phash&&selectFile(file.hash);});trigger();}).shortcut({pattern:"ctrl+a",description:"selectall",callback:selectAll}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(e){select(e.keyCode,e.shiftKey);}}).shortcut({pattern:"home",description:"selectffile",callback:function(e){unselectAll();scrollToView(cwd.find("[id]:first").trigger(evtSelect));trigger();}}).shortcut({pattern:"end",description:"selectlfile",callback:function(e){unselectAll();scrollToView(cwd.find("[id]:last").trigger(evtSelect));trigger();}});});return this;};"use strict";$.fn.elfindertoolbar=function(fm,opts){this.not(".elfinder-toolbar").each(function(){var commands=fm._commands,self=$(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),panels=opts||[],l=panels.length,i,cmd,panel,button;self.prev().length&&self.parent().prepend(this);while(l--){if(panels[l]){panel=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');i=panels[l].length;while(i--){if((cmd=commands[panels[l][i]])){button="elfinder"+cmd.options.ui;$.fn[button]&&panel.prepend($("<div/>")[button](cmd));}}panel.children().length&&self.prepend(panel);panel.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>');}}self.children().length&&self.show();});return this;};"use strict";$.fn.elfinderbutton=function(cmd){return this.each(function(){var c="class",fm=cmd.fm,disabled=fm.res(c,"disabled"),active=fm.res(c,"active"),hover=fm.res(c,"hover"),item="elfinder-button-menu-item",selected="elfinder-button-menu-item-selected",menu,button=$(this).addClass("ui-state-default elfinder-button").attr("title",cmd.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+cmd.name+'"/>').hover(function(e){!button.is("."+disabled)&&button[e.type=="mouseleave"?"removeClass":"addClass"](hover);}).click(function(e){if(!button.is("."+disabled)){if(menu&&cmd.variants.length>1){menu.is(":hidden")&&cmd.fm.getUI().click();e.stopPropagation();menu.slideToggle(100);}else{cmd.exec();}}}),hideMenu=function(){menu.hide();};if($.isArray(cmd.variants)){button.addClass("elfinder-menubutton");menu=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(button).zIndex(12+button.zIndex()).delegate("."+item,"hover",function(){$(this).toggleClass(hover);}).delegate("."+item,"click",function(e){e.preventDefault();e.stopPropagation();button.removeClass(hover);cmd.exec(cmd.fm.selected(),$(this).data("value"));});cmd.fm.bind("disable select",hideMenu).getUI().click(hideMenu);cmd.change(function(){menu.html("");$.each(cmd.variants,function(i,variant){menu.append($('<div class="'+item+'">'+variant[1]+"</div>").data("value",variant[0]).addClass(variant[0]==cmd.value?selected:""));});});}cmd.change(function(){if(cmd.disabled()){button.removeClass(active+" "+hover).addClass(disabled);}else{button.removeClass(disabled);button[cmd.active()?"addClass":"removeClass"](active);}}).change();});};"use strict";$.fn.elfinderuploadbutton=function(cmd){return this.each(function(){var button=$(this).elfinderbutton(cmd).unbind("click"),form=$("<form/>").appendTo(button),input=$('<input type="file" multiple="true"/>').change(function(){var _input=$(this);if(_input.val()){cmd.exec({input:_input.remove()[0]});input.clone(true).appendTo(form);}});form.append(input.clone(true));cmd.change(function(){form[cmd.disabled()?"hide":"show"]();}).change();});};"use strict";$.fn.elfinderviewbutton=function(cmd){return this.each(function(){var button=$(this).elfinderbutton(cmd),icon=button.children(".elfinder-button-icon");cmd.change(function(){var icons=cmd.value=="icons";icon.toggleClass("elfinder-button-icon-view-list",icons);button.attr("title",cmd.fm.i18n(icons?"viewlist":"viewicons"));});});};"use strict";$.fn.elfindersearchbutton=function(cmd){return this.each(function(){var result=false,button=$(this).hide().addClass("ui-widget-content elfinder-button "+cmd.fm.res("class","searchbtn")+""),search=function(){var val=$.trim(input.val());if(val){cmd.exec(val).done(function(){result=true;input.focus();});}else{cmd.fm.trigger("searchend");}},abort=function(){input.val("");if(result){result=false;cmd.fm.trigger("searchend");}},input=$('<input type="text" size="42"/>').appendTo(button).keypress(function(e){e.stopPropagation();}).keydown(function(e){e.stopPropagation();e.keyCode==13&&search();if(e.keyCode==27){e.preventDefault();abort();}});$('<span class="ui-icon ui-icon-search" title="'+cmd.title+'"/>').appendTo(button).click(search);$('<span class="ui-icon ui-icon-close"/>').appendTo(button).click(abort);setTimeout(function(){button.parent().detach();cmd.fm.getUI("toolbar").prepend(button.show());if(cmd.fm.UA.ltIE7){var icon=button.children(cmd.fm.direction=="ltr"?".ui-icon-close":".ui-icon-search");icon.css({right:"",left:parseInt(button.width())-icon.outerWidth(true)});}},200);cmd.fm.error(function(){input.unbind("keydown");}).select(function(){input.blur();}).bind("searchend",function(){input.val("");}).viewchange(abort).shortcut({pattern:"ctrl+f f3",description:cmd.title,callback:function(){input.select().focus();}});});};"use strict";$.fn.elfindersortbutton=function(cmd){return this.each(function(){var fm=cmd.fm,name=cmd.name,c="class",disabled=fm.res(c,"disabled"),hover=fm.res(c,"hover"),item="elfinder-button-menu-item",selected=item+"-selected",asc=selected+"-asc",desc=selected+"-desc",button=$(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+name).attr("title",cmd.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+name+'"/>').hover(function(e){!button.is("."+disabled)&&button.toggleClass(hover);}).click(function(e){if(!button.is("."+disabled)){e.stopPropagation();menu.is(":hidden")&&cmd.fm.getUI().click();menu.slideToggle(100);}}),menu=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(button).zIndex(12+button.zIndex()).delegate("."+item,"hover",function(){$(this).toggleClass(hover);}).delegate("."+item,"click",function(e){e.preventDefault();e.stopPropagation();hide();}),update=function(){menu.children(":not(:last)").removeClass(selected+" "+asc+" "+desc).filter('[rel="'+fm.sortType+'"]').addClass(selected+" "+(fm.sortOrder=="asc"?asc:desc));menu.children(":last").toggleClass(selected,fm.sortStickFolders);},hide=function(){menu.hide();};$.each(fm.sortRules,function(name,value){menu.append($('<div class="'+item+'" rel="'+name+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+fm.i18n("sort"+name)+"</div>").data("type",name));});menu.children().click(function(e){var type=$(this).attr("rel");cmd.exec([],{type:type,order:type==fm.sortType?fm.sortOrder=="asc"?"desc":"asc":fm.sortOrder,stick:fm.sortStickFolders});});$('<div class="'+item+" "+item+'-separated"><span class="ui-icon ui-icon-check"/>'+fm.i18n("sortFoldersFirst")+"</div>").appendTo(menu).click(function(){cmd.exec([],{type:fm.sortType,order:fm.sortOrder,stick:!fm.sortStickFolders});});fm.bind("disable select",hide).getUI().click(hide);fm.bind("sortchange",update);if(menu.children().length>1){cmd.change(function(){button.toggleClass(disabled,cmd.disabled());update();}).change();}else{button.addClass(disabled);}});};$.fn.elfinderpanel=function(fm){return this.each(function(){var panel=$(this).addClass("elfinder-panel ui-state-default ui-corner-all"),margin="margin-"+(fm.direction=="ltr"?"left":"right");fm.one("load",function(e){var navbar=fm.getUI("navbar");panel.css(margin,parseInt(navbar.outerWidth(true)));navbar.bind("resize",function(){panel.is(":visible")&&panel.css(margin,parseInt(navbar.outerWidth(true)));});});});};"use strict";$.fn.elfindercontextmenu=function(fm){return this.each(function(){var menu=$(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+fm.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover");}),subpos=fm.direction=="ltr"?"left":"right",types=$.extend({},fm.options.contextmenu),tpl='<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}</span></div>',item=function(label,icon,callback){return $(tpl.replace("{icon}",icon?"elfinder-button-icon-"+icon:"").replace("{label}",label)).click(function(e){e.stopPropagation();e.stopPropagation();callback();});},open=function(x,y){var win=$(window),width=menu.outerWidth(),height=menu.outerHeight(),wwidth=win.width(),wheight=win.height(),scrolltop=win.scrollTop(),scrollleft=win.scrollLeft(),css={top:(y+height<wheight?y:y-height>0?y-height:y)+scrolltop,left:(x+width<wwidth?x:x-width)+scrollleft,"z-index":100+fm.getUI("workzone").zIndex()};menu.css(css).show();css={"z-index":css["z-index"]+10};css[subpos]=parseInt(menu.width());menu.find(".elfinder-contextmenu-sub").css(css);},close=function(){menu.hide().empty();},create=function(type,targets){var sep=false;$.each(types[type]||[],function(i,name){var cmd,node,submenu;if(name=="|"&&sep){menu.append('<div class="elfinder-contextmenu-separator"/>');sep=false;return;}cmd=fm.command(name);if(cmd&&cmd.getstate(targets)!=-1){if(cmd.variants){if(!cmd.variants.length){return;}node=item(cmd.title,cmd.name,function(){});submenu=$('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(node.append('<span class="elfinder-contextmenu-arrow"/>'));node.addClass("elfinder-contextmenu-group").hover(function(){submenu.toggle();});$.each(cmd.variants,function(i,variant){submenu.append($('<div class="elfinder-contextmenu-item"><span>'+variant[1]+"</span></div>").click(function(e){e.stopPropagation();close();cmd.exec(targets,variant[0]);}));});}else{node=item(cmd.title,cmd.name,function(){close();cmd.exec(targets);});}menu.append(node);sep=true;}});},createFromRaw=function(raw){$.each(raw,function(i,data){var node;if(data.label&&typeof data.callback=="function"){node=item(data.label,data.icon,function(){close();data.callback();});menu.append(node);}});};fm.one("load",function(){fm.bind("contextmenu",function(e){var data=e.data;close();if(data.type&&data.targets){create(data.type,data.targets);}else{if(data.raw){createFromRaw(data.raw);}}menu.children().length&&open(data.x,data.y);}).one("destroy",function(){menu.remove();}).bind("disable select",close).getUI().click(close);});});};"use strict";$.fn.elfinderpath=function(fm){return this.each(function(){var path=$(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(e){var hash=$(this).attr("href").substr(1);e.preventDefault();hash!=fm.cwd().hash&&fm.exec("open",hash);}).prependTo(fm.getUI("statusbar").show());fm.bind("open searchend",function(){var dirs=[];$.each(fm.parents(fm.cwd().hash),function(i,hash){dirs.push('<a href="#'+hash+'">'+fm.escape(fm.file(hash).name)+"</a>");});path.html(dirs.join(fm.option("separator")));}).bind("search",function(){path.html(fm.i18n("searcresult"));});});};"use strict";$.fn.elfinderstat=function(fm){return this.each(function(){var size=$(this).addClass("elfinder-stat-size"),sel=$('<div class="elfinder-stat-selected"/>'),titlesize=fm.i18n("size").toLowerCase(),titleitems=fm.i18n("items").toLowerCase(),titlesel=fm.i18n("selected"),setstat=function(files,cwd){var c=0,s=0;$.each(files,function(i,file){if(!cwd||file.phash==cwd){c++;s+=parseInt(file.size)||0;}});size.html(titleitems+": "+c+", "+titlesize+": "+fm.formatSize(s));};fm.getUI("statusbar").prepend(size).append(sel).show();fm.bind("open reload add remove change searchend",function(){setstat(fm.files(),fm.cwd().hash);}).search(function(e){setstat(e.data.files);}).select(function(){var s=0,c=0,files=fm.selectedFiles();if(files.length==1){s=files[0].size;sel.html(fm.escape(files[0].name)+(s>0?", "+fm.formatSize(s):""));return;}$.each(files,function(i,file){c++;s+=parseInt(file.size)||0;});sel.html(c?titlesel+": "+c+", "+titlesize+": "+fm.formatSize(s):"&nbsp;");});});};"use strict";$.fn.elfinderplaces=function(fm,opts){return this.each(function(){var dirs=[],c="class",navdir=fm.res(c,"navdir"),collapsed=fm.res(c,"navcollapse"),expanded=fm.res(c,"navexpand"),hover=fm.res(c,"hover"),clroot=fm.res(c,"treeroot"),tpl=fm.res("tpl","navdir"),ptpl=fm.res("tpl","perms"),spinner=$(fm.res("tpl","navspinner")),id2hash=function(id){return id.substr(6);},hash2id=function(hash){return"place-"+hash;},save=function(){fm.storage("places",dirs.join(","));},create=function(dir){return $(tpl.replace(/\{id\}/,hash2id(dir.hash)).replace(/\{name\}/,fm.escape(dir.name)).replace(/\{cssclass\}/,fm.perms2class(dir)).replace(/\{permissions\}/,!dir.read||!dir.write?ptpl:"").replace(/\{symlink\}/,""));},add=function(dir){var node=create(dir);if(subtree.children().length){$.each(subtree.children(),function(){var current=$(this);if(dir.name.localeCompare(current.children("."+navdir).text())<0){return !node.insertBefore(current);}});}dirs.push(dir.hash);!node.parent().length&&subtree.append(node);root.addClass(collapsed);node.draggable({appendTo:"body",revert:false,helper:function(){var dir=$(this);dir.children().removeClass("ui-state-hover");return $('<div class="elfinder-place-drag elfinder-'+fm.direction+'"/>').append(dir.clone()).data("hash",id2hash(dir.children(":first").attr("id")));},start:function(){$(this).hide();},stop:function(e,ui){var top=places.offset().top,left=places.offset().left,width=places.width(),height=places.height(),x=e.clientX,y=e.clientY;if(x>left&&x<left+width&&y>top&&y<y+height){$(this).show();}else{remove(ui.helper.data("hash"));save();}}});},remove=function(hash){var ndx=$.inArray(hash,dirs);if(ndx!==-1){dirs.splice(ndx,1);subtree.find("#"+hash2id(hash)).parent().remove();!subtree.children().length&&root.removeClass(collapsed+" "+expanded);}},clear=function(){subtree.empty();root.removeClass(collapsed+" "+expanded);},wrapper=create({hash:"root-"+fm.namespace,name:fm.i18n(opts.name,"places"),read:true,write:true}),root=wrapper.children("."+navdir).addClass(clroot).click(function(){if(root.is("."+collapsed)){places.toggleClass(expanded);subtree.slideToggle();fm.storage("placesState",places.is("."+expanded)?1:0);}}),subtree=wrapper.children("."+fm.res(c,"navsubtree")),places=$(this).addClass(fm.res(c,"tree")+" elfinder-places ui-corner-all").hide().append(wrapper).appendTo(fm.getUI("navbar")).delegate("."+navdir,"hover",function(){$(this).toggleClass("ui-state-hover");}).delegate("."+navdir,"click",function(e){fm.exec("open",$(this).attr("id").substr(6));}).delegate("."+navdir+":not(."+clroot+")","contextmenu",function(e){var hash=$(this).attr("id").substr(6);e.preventDefault();fm.trigger("contextmenu",{raw:[{label:fm.i18n("rmFromPlaces"),icon:"rm",callback:function(){remove(hash);save();}}],x:e.clientX,y:e.clientY});}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:fm.res("class","adroppable"),drop:function(e,ui){var resolve=true;$.each(ui.helper.data("files"),function(i,hash){var dir=fm.file(hash);if(dir&&dir.mime=="directory"&&$.inArray(dir.hash,dirs)===-1){add(dir);}else{resolve=false;}});save();resolve&&ui.helper.hide();}});fm.one("load",function(){if(fm.oldAPI){return;}places.show().parent().show();dirs=$.map(fm.storage("places").split(","),function(hash){return hash||null;});if(dirs.length){root.prepend(spinner);fm.request({data:{cmd:"info",targets:dirs},preventDefault:true}).done(function(data){dirs=[];$.each(data.files,function(i,file){file.mime=="directory"&&add(file);});save();if(fm.storage("placesState")>0){root.click();}}).always(function(){spinner.remove();});}fm.remove(function(e){$.each(e.data.removed,function(i,hash){remove(hash);});save();}).change(function(e){$.each(e.data.changed,function(i,file){if($.inArray(file.hash,dirs)!==-1){remove(file.hash);file.mime=="directory"&&add(file);}});save();}).bind("sync",function(){if(dirs.length){root.prepend(spinner);fm.request({data:{cmd:"info",targets:dirs},preventDefault:true}).done(function(data){$.each(data.files||[],function(i,file){if($.inArray(file.hash,dirs)===-1){remove(file.hash);}});save();}).always(function(){spinner.remove();});}});});});};"use strict";elFinder.prototype.commands.back=function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1;};this.exec=function(){return this.fm.history.back();};};elFinder.prototype.commands.forward=function(){this.alwaysEnabled=true;this.updateOnSelect=true;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1;};this.exec=function(){return this.fm.history.forward();};};elFinder.prototype.commands.reload=function(){this.alwaysEnabled=true;this.updateOnSelect=true;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0;};this.exec=function(){var fm=this.fm,dfrd=fm.sync(),timeout=setTimeout(function(){fm.notify({type:"reload",cnt:1,hideCnt:true});dfrd.always(function(){fm.notify({type:"reload",cnt:-1});});},fm.notifyDelay);return dfrd.always(function(){clearTimeout(timeout);fm.trigger("reload");});};};"use strict";elFinder.prototype.commands.up=function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1;};this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):$.Deferred().reject();};};elFinder.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];this.getstate=function(){var root=this.fm.root(),cwd=this.fm.cwd().hash;return root&&cwd&&root!=cwd?0:-1;};this.exec=function(){return this.fm.exec("open",this.fm.root());};};"use strict";elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(sel){var sel=this.files(sel),cnt=sel.length;return cnt&&$.map(sel,function(f){return f.phash&&f.read?f:null;}).length==cnt?0:-1;};this.exec=function(hashes){var fm=this.fm,dfrd=$.Deferred().fail(function(error){fm.error(error);});$.each(this.files(hashes),function(i,file){if(!(file.read&&file.phash)){return !dfrd.reject(["errCopy",file.name,"errPerm"]);}});return dfrd.state()=="rejected"?dfrd:dfrd.resolve(fm.clipboard(this.hashes(hashes)));};};"use strict";elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(sel){var sel=this.files(sel),cnt=sel.length;return cnt&&$.map(sel,function(f){return f.phash&&f.read&&!f.locked?f:null;}).length==cnt?0:-1;};this.exec=function(hashes){var fm=this.fm,dfrd=$.Deferred().fail(function(error){fm.error(error);});$.each(this.files(hashes),function(i,file){if(!(file.read&&file.phash)){return !dfrd.reject(["errCopy",file.name,"errPerm"]);}if(file.locked){return !dfrd.reject(["errLocked",file.name]);}});return dfrd.state()=="rejected"?dfrd:dfrd.resolve(fm.clipboard(this.hashes(hashes),true));};};"use strict";elFinder.prototype.commands.paste=function(){this.updateOnSelect=false;this.handlers={changeclipboard:function(){this.update();}};this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(dst){if(this._disabled){return -1;}if(dst){if($.isArray(dst)){if(dst.length!=1){return -1;}dst=this.fm.file(dst[0]);}}else{dst=this.fm.cwd();}return this.fm.clipboard().length&&dst.mime=="directory"&&dst.write?0:-1;};this.exec=function(dst){var self=this,fm=self.fm,dst=dst?this.files(dst)[0]:fm.cwd(),files=fm.clipboard(),cnt=files.length,cut=cnt?files[0].cut:false,error=cut?"errMove":"errCopy",fpaste=[],fcopy=[],dfrd=$.Deferred().fail(function(error){error&&fm.error(error);}),copy=function(files){return files.length&&fm._commands.duplicate?fm.exec("duplicate",files):$.Deferred().resolve();},paste=function(files){var dfrd=$.Deferred(),existed=[],intersect=function(files,names){var ret=[],i=files.length;while(i--){$.inArray(files[i].name,names)!==-1&&ret.unshift(i);}return ret;},confirm=function(ndx){var i=existed[ndx],file=files[i],last=ndx==existed.length-1;if(!file){return;}fm.confirm({title:fm.i18n(cut?"moveFiles":"copyFiles"),text:fm.i18n(["errExists",file.name,"confirmRepl"]),all:!last,accept:{label:"btnYes",callback:function(all){!last&&!all?confirm(++ndx):paste(files);}},reject:{label:"btnNo",callback:function(all){var i;if(all){i=existed.length;while(ndx<i--){files[existed[i]].remove=true;}}else{files[existed[ndx]].remove=true;}!last&&!all?confirm(++ndx):paste(files);}},cancel:{label:"btnCancel",callback:function(){dfrd.resolve();}}});},valid=function(names){existed=intersect(files,names);existed.length?confirm(0):paste(files);},paste=function(files){var files=$.map(files,function(file){return !file.remove?file:null;}),cnt=files.length,groups={},args=[],src;if(!cnt){return dfrd.resolve();}src=files[0].phash;files=$.map(files,function(f){return f.hash;});fm.request({data:{cmd:"paste",dst:dst.hash,targets:files,cut:cut?1:0,src:src},notify:{type:cut?"move":"copy",cnt:cnt}}).always(function(){dfrd.resolve();fm.unlockfiles({files:files});});};if(self._disabled||!files.length){return dfrd.resolve();}if(fm.oldAPI){paste(files);}else{if(!fm.option("copyOverwrite")){paste(files);}else{dst.hash==fm.cwd().hash?valid($.map(fm.files(),function(file){return file.phash==dst.hash?file.name:null;})):fm.request({data:{cmd:"ls",target:dst.hash},notify:{type:"prepare",cnt:1,hideCnt:true},preventFail:true}).always(function(data){valid(data.list||[]);});}}return dfrd;},parents,fparents;if(!cnt||!dst||dst.mime!="directory"){return dfrd.reject();}if(!dst.write){return dfrd.reject([error,files[0].name,"errPerm"]);}parents=fm.parents(dst.hash);$.each(files,function(i,file){if(!file.read){return !dfrd.reject([error,files[0].name,"errPerm"]);}if(cut&&file.locked){return !dfrd.reject(["errLocked",file.name]);}if($.inArray(file.hash,parents)!==-1){return !dfrd.reject(["errCopyInItself",file.name]);}fparents=fm.parents(file.hash);fparents.pop();if($.inArray(dst.hash,fparents)!==-1){if($.map(fparents,function(h){var d=fm.file(h);return d.phash==dst.hash&&d.name==file.name?d:null;}).length){return !dfrd.reject(["errReplByChild",file.name]);}}if(file.phash==dst.hash){fcopy.push(file.hash);}else{fpaste.push({hash:file.hash,phash:file.phash,name:file.name});}});if(dfrd.state()=="rejected"){return dfrd;}return $.when(copy(fcopy),paste(fpaste)).always(function(){cut&&fm.clipboard([]);});};};"use strict";elFinder.prototype.commands.open=function(){this.alwaysEnabled=true;this._handlers={dblclick:function(e){e.preventDefault();this.exec();},"select enable disable reload":function(e){this.update(e.type=="disable"?-1:void (0));}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+(this.fm.OS!="mac"&&" enter")}];this.getstate=function(sel){var sel=this.files(sel),cnt=sel.length;return cnt==1?0:cnt?($.map(sel,function(file){return file.mime=="directory"?null:file;}).length==cnt?0:-1):-1;};this.exec=function(hashes){var fm=this.fm,dfrd=$.Deferred().fail(function(error){error&&fm.error(error);}),files=this.files(hashes),cnt=files.length,file,url,s,w;if(!cnt){return dfrd.reject();}if(cnt==1&&(file=files[0])&&file.mime=="directory"){return file&&!file.read?dfrd.reject(["errOpen",file.name,"errPerm"]):fm.request({data:{cmd:"open",target:file.thash||file.hash},notify:{type:"open",cnt:1,hideCnt:true},syncOnFail:true});}files=$.map(files,function(file){return file.mime!="directory"?file:null;});if(cnt!=files.length){return dfrd.reject();}cnt=files.length;while(cnt--){file=files[cnt];if(!file.read){return dfrd.reject(["errOpen",file.name,"errPerm"]);}if(!(url=fm.url(file.hash))){url=fm.options.url;url=url+(url.indexOf("?")===-1?"?":"&")+(fm.oldAPI?"cmd=open&current="+file.phash:"cmd=file")+"&target="+file.hash;}if(file.dim){s=file.dim.split("x");w="width="+(parseInt(s[0])+20)+",height="+(parseInt(s[1])+20);}else{w="width="+parseInt(2*$(window).width()/3)+",height="+parseInt(2*$(window).height()/3);}var wnd=window.open("","new_window",w+",top=50,left=50,scrollbars=yes,resizable=yes");if(!wnd){return dfrd.reject("errPopup");}var form=document.createElement("form");form.action=fm.options.url;form.method="POST";form.target="new_window";form.style.display="none";var params=$.extend({},fm.options.customData,{cmd:"file",target:file.hash});$.each(params,function(key,val){var input=document.createElement("input");input.name=key;input.value=val;form.appendChild(input);});document.body.appendChild(form);form.submit();}return dfrd.resolve(hashes);};};"use strict";elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}];this.getstate=function(sel){var fm=this.fm;sel=sel||fm.selected();return !this._disabled&&sel.length&&$.map(sel,function(h){var f=fm.file(h);return f&&f.phash&&!f.locked?h:null;}).length==sel.length?0:-1;};this.exec=function(hashes){var self=this,fm=this.fm,dfrd=$.Deferred().fail(function(error){error&&fm.error(error);}),files=this.files(hashes),cnt=files.length,cwd=fm.cwd().hash,goroot=false;if(!cnt||this._disabled){return dfrd.reject();}$.each(files,function(i,file){if(!file.phash){return !dfrd.reject(["errRm",file.name,"errPerm"]);}if(file.locked){return !dfrd.reject(["errLocked",file.name]);}if(file.hash==cwd){goroot=fm.root(file.hash);}});if(dfrd.state()=="pending"){files=this.hashes(hashes);fm.confirm({title:self.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){fm.lockfiles({files:files});fm.request({data:{cmd:"rm",targets:files},notify:{type:"rm",cnt:cnt},preventFail:true}).fail(function(error){dfrd.reject(error);}).done(function(data){dfrd.done(data);goroot&&fm.exec("open",goroot);}).always(function(){fm.unlockfiles({files:files});});}},cancel:{label:"btnCancel",callback:function(){dfrd.reject();}}});}return dfrd;};};"use strict";elFinder.prototype.commands.info=function(){var m="msg",fm=this.fm,spclass="elfinder-info-spinner",msg={calc:fm.i18n("calc"),size:fm.i18n("size"),unknown:fm.i18n("unknown"),path:fm.i18n("path"),aliasfor:fm.i18n("aliasfor"),modify:fm.i18n("modify"),perms:fm.i18n("perms"),locked:fm.i18n("locked"),dim:fm.i18n("dim"),kind:fm.i18n("kind"),files:fm.i18n("files"),folders:fm.i18n("folders"),items:fm.i18n("items"),yes:fm.i18n("yes"),no:fm.i18n("no"),link:fm.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="'+spclass+'"/>'};this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){$.each(msg,function(k,v){msg[k]=fm.i18n(v);});};this.getstate=function(){return 0;};this.exec=function(hashes){var files=this.files(hashes);if(!files.length){files=this.files([this.fm.cwd().hash]);}var self=this,fm=this.fm,o=this.options,tpl=this.tpl,row=tpl.row,cnt=files.length,content=[],view=tpl.main,l="{label}",v="{value}",opts={title:this.title,width:"auto",close:function(){$(this).elfinderdialog("destroy");}},count=[],replSpinner=function(msg){dialog.find("."+spclass).parent().text(msg);},id=fm.namespace+"-info-"+$.map(files,function(f){return f.hash;}).join("-"),dialog=fm.getUI().find("#"+id),size,tmb,file,title,dcnt;if(!cnt){return $.Deferred().reject();}if(dialog.length){dialog.elfinderdialog("toTop");return $.Deferred().resolve();}if(cnt==1){file=files[0];view=view.replace("{class}",fm.mime2class(file.mime));title=tpl.itemTitle.replace("{name}",fm.escape(file.i18||file.name)).replace("{kind}",fm.mime2kind(file));if(file.tmb){tmb=fm.option("tmbUrl")+file.tmb;}if(!file.read){size=msg.unknown;}else{if(file.mime!="directory"||file.alias){size=fm.formatSize(file.size);}else{size=tpl.spinner.replace("{text}",msg.calc);count.push(file.hash);}}content.push(row.replace(l,msg.size).replace(v,size));file.alias&&content.push(row.replace(l,msg.aliasfor).replace(v,file.alias));content.push(row.replace(l,msg.path).replace(v,fm.escape(fm.path(file.hash,true))));if(file.read){var href;if(o.nullUrlDirLinkSelf&&file.mime=="directory"&&file.url===null){var loc=window.location;href=loc.pathname+loc.search+"#elf_"+file.hash;}else{href=fm.url(file.hash);}content.push(row.replace(l,msg.link).replace(v,'<a href="'+href+'" target="_blank">'+file.name+"</a>"));}if(file.dim){content.push(row.replace(l,msg.dim).replace(v,file.dim));}else{if(file.mime.indexOf("image")!==-1){if(file.width&&file.height){content.push(row.replace(l,msg.dim).replace(v,file.width+"x"+file.height));}else{content.push(row.replace(l,msg.dim).replace(v,tpl.spinner.replace("{text}",msg.calc)));fm.request({data:{cmd:"dim",target:file.hash},preventDefault:true}).fail(function(){replSpinner(msg.unknown);}).done(function(data){replSpinner(data.dim||msg.unknown);if(data.dim){var dim=data.dim.split("x");var rfile=fm.file(file.hash);rfile.width=dim[0];rfile.height=dim[1];}});}}}content.push(row.replace(l,msg.modify).replace(v,fm.formatDate(file)));content.push(row.replace(l,msg.perms).replace(v,fm.formatPermissions(file)));content.push(row.replace(l,msg.locked).replace(v,file.locked?msg.yes:msg.no));}else{view=view.replace("{class}","elfinder-cwd-icon-group");title=tpl.groupTitle.replace("{items}",msg.items).replace("{num}",cnt);dcnt=$.map(files,function(f){return f.mime=="directory"?1:null;}).length;if(!dcnt){size=0;$.each(files,function(h,f){var s=parseInt(f.size);if(s>=0&&size>=0){size+=s;}else{size="unknown";}});content.push(row.replace(l,msg.kind).replace(v,msg.files));content.push(row.replace(l,msg.size).replace(v,fm.formatSize(size)));}else{content.push(row.replace(l,msg.kind).replace(v,dcnt==cnt?msg.folders:msg.folders+" "+dcnt+", "+msg.files+" "+(cnt-dcnt)));content.push(row.replace(l,msg.size).replace(v,tpl.spinner.replace("{text}",msg.calc)));count=$.map(files,function(f){return f.hash;});}}view=view.replace("{title}",title).replace("{content}",content.join(""));dialog=fm.dialog(view,opts);dialog.attr("id",id);if(tmb){$("<img/>").load(function(){dialog.find(".elfinder-cwd-icon").css("background",'url("'+tmb+'") center center no-repeat');}).attr("src",tmb);}if(count.length){fm.request({data:{cmd:"size",targets:count},preventDefault:true}).fail(function(){replSpinner(msg.unknown);}).done(function(data){var size=parseInt(data.size);replSpinner(size>=0?fm.formatSize(size):msg.unknown);});}};};"use strict";elFinder.prototype.commands.duplicate=function(){var fm=this.fm;this.getstate=function(sel){var sel=this.files(sel),cnt=sel.length;return !this._disabled&&cnt&&fm.cwd().write&&$.map(sel,function(f){return f.phash&&f.read?f:null;}).length==cnt?0:-1;};this.exec=function(hashes){var fm=this.fm,files=this.files(hashes),cnt=files.length,dfrd=$.Deferred().fail(function(error){error&&fm.error(error);}),args=[];if(!cnt||this._disabled){return dfrd.reject();}$.each(files,function(i,file){if(!file.read||!fm.file(file.phash).write){return !dfrd.reject(["errCopy",file.name,"errPerm"]);}});if(dfrd.state()=="rejected"){return dfrd;}return fm.request({data:{cmd:"duplicate",targets:this.hashes(hashes)},notify:{type:"copy",cnt:cnt}});};};"use strict";elFinder.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+(this.fm.OS=="mac"?" enter":"")}];this.getstate=function(){var sel=this.fm.selectedFiles();return !this._disabled&&sel.length==1&&sel[0].phash&&!sel[0].locked?0:-1;};this.exec=function(){var fm=this.fm,cwd=fm.getUI("cwd"),sel=fm.selected(),cnt=sel.length,file=fm.file(sel.shift()),filename=".elfinder-cwd-filename",dfrd=$.Deferred().fail(function(error){var parent=input.parent(),name=fm.escape(file.name);if(parent.length){input.remove();parent.html(name);}else{cwd.find("#"+file.hash).find(filename).html(name);setTimeout(function(){cwd.find("#"+file.hash).click();},50);}error&&fm.error(error);}).always(function(){fm.enable();}),input=$('<input type="text"/>').keydown(function(e){e.stopPropagation();e.stopImmediatePropagation();if(e.keyCode==$.ui.keyCode.ESCAPE){dfrd.reject();}else{if(e.keyCode==$.ui.keyCode.ENTER){input.blur();}}}).mousedown(function(e){e.stopPropagation();}).dblclick(function(e){e.stopPropagation();e.preventDefault();}).blur(function(){var name=$.trim(input.val()),parent=input.parent();if(parent.length){if(input[0].setSelectionRange){input[0].setSelectionRange(0,0);}if(name==file.name){return dfrd.reject();}if(!name){return dfrd.reject("errInvName");}if(fm.fileByName(name,file.phash)){return dfrd.reject(["errExists",name]);}parent.html(fm.escape(name));fm.lockfiles({files:[file.hash]});fm.request({data:{cmd:"rename",target:file.hash,name:name},notify:{type:"rename",cnt:1}}).fail(function(error){dfrd.reject();fm.sync();}).done(function(data){dfrd.resolve(data);}).always(function(){fm.unlockfiles({files:[file.hash]});});}}),node=cwd.find("#"+file.hash).find(filename).empty().append(input.val(file.name)),name=input.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,"");if(this.disabled()){return dfrd.reject();}if(!file||cnt>1||!node.length){return dfrd.reject("errCmdParams",this.title);}if(file.locked){return dfrd.reject(["errLocked",file.name]);}fm.one("select",function(){input.parent().length&&file&&$.inArray(file.hash,fm.selected())===-1&&input.blur();});input.select().focus();input[0].setSelectionRange&&input[0].setSelectionRange(0,name.length);return dfrd;};};"use strict";elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.mime="directory";this.prefix="untitled folder";this.exec=$.proxy(this.fm.res("mixin","make"),this);this.shortcuts=[{pattern:"ctrl+shift+n"}];this.getstate=function(){return !this._disabled&&this.fm.cwd().write?0:-1;};};"use strict";elFinder.prototype.commands.upload=function(){var hover=this.fm.res("class","hover");this.disableOnSearch=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(){return !this._disabled&&this.fm.cwd().write?0:-1;};this.exec=function(data){var fm=this.fm,upload=function(data){dialog.elfinderdialog("close");fm.upload(data).fail(function(error){dfrd.reject(error);}).done(function(data){dfrd.resolve(data);});},dfrd,dialog,input,button,dropbox;if(this.disabled()){return $.Deferred().reject();}if(data&&(data.input||data.files)){return fm.upload(data);}dfrd=$.Deferred();input=$('<input type="file" multiple="true"/>').change(function(){upload({input:input[0]});});button=$('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+fm.i18n("selectForUpload")+"</span></div>").append($("<form/>").append(input)).hover(function(){button.toggleClass(hover);});dialog=$('<div class="elfinder-upload-dialog-wrapper"/>').append(button);if(fm.dragUpload){dropbox=$('<div class="ui-corner-all elfinder-upload-dropbox">'+fm.i18n("dropFiles")+"</div>").prependTo(dialog).after('<div class="elfinder-upload-dialog-or">'+fm.i18n("or")+"</div>")[0];dropbox.addEventListener("dragenter",function(e){e.stopPropagation();e.preventDefault();$(dropbox).addClass(hover);},false);dropbox.addEventListener("dragleave",function(e){e.stopPropagation();e.preventDefault();$(dropbox).removeClass(hover);},false);dropbox.addEventListener("dragover",function(e){e.stopPropagation();e.preventDefault();},false);dropbox.addEventListener("drop",function(e){e.stopPropagation();e.preventDefault();upload({files:e.dataTransfer.files});},false);}fm.dialog(dialog,{title:this.title,modal:true,resizable:false,destroyOnClose:true});return dfrd;};};"use strict";elFinder.prototype.commands.download=function(){var self=this,fm=this.fm,filter=function(hashes){return $.map(self.files(hashes),function(f){return f.mime=="directory"?null:f;});};this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(){var sel=this.fm.selected(),cnt=sel.length;return !this._disabled&&cnt&&(!fm.UA.IE||cnt==1)&&cnt==filter(sel).length?0:-1;};this.exec=function(hashes){var fm=this.fm,base=fm.options.url,files=filter(hashes),dfrd=$.Deferred(),iframes="",cdata="",i,url;if(this.disabled()){return dfrd.reject();}if(fm.oldAPI){fm.error("errCmdNoSupport");return dfrd.reject();}cdata=$.param(fm.options.customData||{});if(cdata){cdata="&"+cdata;}base+=base.indexOf("?")===-1?"?":"&";for(i=0;i<files.length;i++){iframes+='<iframe class="downloader" id="downloader-'+files[i].hash+'" style="display:none" src="'+base+"cmd=file&target="+files[i].hash+"&download=1"+cdata+'"/>';}$(iframes).appendTo("body").ready(function(){setTimeout(function(){$(iframes).each(function(){$("#"+$(this).attr("id")).remove();});},fm.UA.Firefox?(20000+(10000*i)):1000);});fm.trigger("download",{files:files});return dfrd.resolve(hashes);};};"use strict";elFinder.prototype.commands.edit=function(){var self=this,fm=this.fm,mimes=fm.res("mimes","text")||[],filter=function(files){return $.map(files,function(file){return(file.mime.indexOf("text/")===0||$.inArray(file.mime,mimes)!==-1)&&file.mime.indexOf("text/rtf")&&(!self.onlyMimes.length||$.inArray(file.mime,self.onlyMimes)!==-1)&&file.read&&file.write?file:null;});},dialog=function(id,file,content){var dfrd=$.Deferred(),ta=$('<textarea class="elfinder-file-edit" rows="20" id="'+id+'-ta">'+fm.escape(content)+"</textarea>"),save=function(){ta.editor&&ta.editor.save(ta[0],ta.editor.instance);dfrd.resolve(ta.getContent());ta.elfinderdialog("close");},cancel=function(){dfrd.reject();ta.elfinderdialog("close");},opts={title:file.name,width:self.options.dialogWidth||450,buttons:{},close:function(){ta.editor&&ta.editor.close(ta[0],ta.editor.instance);$(this).elfinderdialog("destroy");},open:function(){fm.disable();ta.focus();ta[0].setSelectionRange&&ta[0].setSelectionRange(0,0);ta.editor&&ta.editor.load(ta[0]);}};ta.getContent=function(){return ta.val();};$.each(self.options.editors||[],function(i,editor){if($.inArray(file.mime,editor.mimes||[])!==-1&&typeof editor.load=="function"&&typeof editor.save=="function"){ta.editor={load:editor.load,save:editor.save,close:typeof editor.close=="function"?editor.close:function(){},instance:null};return false;}});if(!ta.editor){ta.keydown(function(e){var code=e.keyCode,value,start;e.stopPropagation();if(code==9){e.preventDefault();if(this.setSelectionRange){value=this.value;start=this.selectionStart;this.value=value.substr(0,start)+"\t"+value.substr(this.selectionEnd);start+=1;this.setSelectionRange(start,start);}}if(e.ctrlKey||e.metaKey){if(code==81||code==87){e.preventDefault();cancel();}if(code==83){e.preventDefault();save();}}});}opts.buttons[fm.i18n("Save")]=save;opts.buttons[fm.i18n("Cancel")]=cancel;fm.dialog(ta,opts).attr("id",id);return dfrd.promise();},edit=function(file){var hash=file.hash,opts=fm.options,dfrd=$.Deferred(),data={cmd:"file",target:hash},url=fm.url(hash)||fm.options.url,id="edit-"+fm.namespace+"-"+file.hash,d=fm.getUI().find("#"+id),error;if(d.length){d.elfinderdialog("toTop");return dfrd.resolve();}if(!file.read||!file.write){error=["errOpen",file.name,"errPerm"];fm.error(error);return dfrd.reject(error);}fm.request({data:{cmd:"get",target:hash},notify:{type:"openfile",cnt:1},syncOnFail:true}).done(function(data){dialog(id,file,data.content).done(function(content){fm.request({options:{type:"post"},data:{cmd:"put",target:hash,content:content},notify:{type:"save",cnt:1},syncOnFail:true}).fail(function(error){dfrd.reject(error);}).done(function(data){data.changed&&data.changed.length&&fm.change(data);dfrd.resolve(data);});});}).fail(function(error){dfrd.reject(error);});return dfrd.promise();};this.shortcuts=[{pattern:"ctrl+e"}];this.init=function(){this.onlyMimes=this.options.mimes||[];};this.getstate=function(sel){var sel=this.files(sel),cnt=sel.length;return !this._disabled&&cnt&&filter(sel).length==cnt?0:-1;};this.exec=function(hashes){var files=filter(this.files(hashes)),list=[],file;if(this.disabled()){return $.Deferred().reject();}while((file=files.shift())){list.push(edit(file));}return list.length?$.when.apply(null,list):$.Deferred().reject();};};"use strict";elFinder.prototype.commands.quicklook=function(){var self=this,fm=self.fm,closed=0,animated=1,opened=2,state=closed,navicon="elfinder-quicklook-navbar-icon",fullscreen="elfinder-quicklook-fullscreen",navtrigger=function(code){$(document).trigger($.Event("keydown",{keyCode:code,ctrlKey:false,shiftKey:false,altKey:false,metaKey:false}));},closedCss=function(node){return{opacity:0,width:20,height:fm.view=="list"?1:20,top:node.offset().top+"px",left:node.offset().left+"px"};},openedCss=function(){var win=$(window);return{opacity:1,width:width,height:height,top:parseInt((win.height()-height)/2+win.scrollTop()),left:parseInt((win.width()-width)/2+win.scrollLeft())};},support=function(codec){var media=document.createElement(codec.substr(0,codec.indexOf("/"))),value=false;try{value=media.canPlayType&&media.canPlayType(codec);}catch(e){}return value&&value!==""&&value!="no";},width,height,parent,cwd,title=$('<div class="elfinder-quicklook-title"/>'),icon=$("<div/>"),info=$('<div class="elfinder-quicklook-info"/>'),fsicon=$('<div class="'+navicon+" "+navicon+'-fullscreen"/>').mousedown(function(e){var win=self.window,full=win.is("."+fullscreen),scroll="scroll."+fm.namespace,$window=$(window);e.stopPropagation();if(full){win.css(win.data("position")).unbind("mousemove");$window.unbind(scroll).trigger(self.resize).unbind(self.resize);navbar.unbind("mouseenter").unbind("mousemove");}else{win.data("position",{left:win.css("left"),top:win.css("top"),width:win.width(),height:win.height()}).css({width:"100%",height:"100%"});$(window).bind(scroll,function(){win.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"});}).bind(self.resize,function(e){self.preview.trigger("changesize");}).trigger(scroll).trigger(self.resize);win.bind("mousemove",function(e){navbar.stop(true,true).show().delay(3000).fadeOut("slow");}).mousemove();navbar.mouseenter(function(){navbar.stop(true,true).show();}).mousemove(function(e){e.stopPropagation();});}navbar.attr("style","").draggable(full?"destroy":{});win.toggleClass(fullscreen);$(this).toggleClass(navicon+"-fullscreen-off");$.fn.resizable&&parent.add(win).resizable(full?"enable":"disable").removeClass("ui-state-disabled");}),navbar=$('<div class="elfinder-quicklook-navbar"/>').append($('<div class="'+navicon+" "+navicon+'-prev"/>').mousedown(function(){navtrigger(37);})).append(fsicon).append($('<div class="'+navicon+" "+navicon+'-next"/>').mousedown(function(){navtrigger(39);})).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="'+navicon+" "+navicon+'-close"/>').mousedown(function(){self.window.trigger("close");}));this.resize="resize."+fm.namespace;this.info=$('<div class="elfinder-quicklook-info-wrapper"/>').append(icon).append(info);this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(e){self.info.attr("style","").hide();icon.removeAttr("class").attr("style","");info.html("");}).bind("update",function(e){var fm=self.fm,preview=self.preview,file=e.file,tpl='<div class="elfinder-quicklook-info-data">{value}</div>',tmb;if(file){!file.read&&e.stopImmediatePropagation();self.window.data("hash",file.hash);self.preview.unbind("changesize").trigger("change").children().remove();title.html(fm.escape(file.name));info.html(tpl.replace(/\{value\}/,file.name)+tpl.replace(/\{value\}/,fm.mime2kind(file))+(file.mime=="directory"?"":tpl.replace(/\{value\}/,fm.formatSize(file.size)))+tpl.replace(/\{value\}/,fm.i18n("modify")+": "+fm.formatDate(file)));icon.addClass("elfinder-cwd-icon ui-corner-all "+fm.mime2class(file.mime));if(file.tmb){$("<img/>").hide().appendTo(self.preview).load(function(){icon.css("background",'url("'+tmb+'") center center no-repeat');$(this).remove();}).attr("src",(tmb=fm.tmb(file.hash)));}self.info.delay(100).fadeIn(10);}else{e.stopImmediatePropagation();}});this.window=$('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(e){e.stopPropagation();}).append($('<div class="elfinder-quicklook-titlebar"/>').append(title).append($('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(e){e.stopPropagation();self.window.trigger("close");}))).append(this.preview.add(navbar)).append(self.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(e){var win=self.window,file=self.value,node;if(self.closed()&&file&&(node=cwd.find("#"+file.hash)).length){navbar.attr("style","");state=animated;node.trigger("scrolltoview");win.css(closedCss(node)).show().animate(openedCss(),550,function(){state=opened;self.update(1,self.value);});}}).bind("close",function(e){var win=self.window,preview=self.preview.trigger("change"),file=self.value,node=cwd.find("#"+win.data("hash")),close=function(){state=closed;win.hide();preview.children().remove();self.update(0,self.value);};if(self.opened()){state=animated;win.is("."+fullscreen)&&fsicon.mousedown();node.length?win.animate(closedCss(node),500,close):close();}});this.alwaysEnabled=true;this.value=null;this.handlers={select:function(){this.update(void (0),this.fm.selectedFiles()[0]);},error:function(){self.window.is(":visible")&&self.window.data("hash","").trigger("close");},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close");}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:support('audio/ogg; codecs="vorbis"'),mp3:support("audio/mpeg;"),wav:support('audio/wav; codecs="1"'),m4a:support("audio/x-m4a;")||support("audio/aac;")},video:{ogg:support('video/ogg; codecs="theora"'),webm:support('video/webm; codecs="vp8, vorbis"'),mp4:support('video/mp4; codecs="avc1.42E01E"')||support('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}};this.closed=function(){return state==closed;};this.opened=function(){return state==opened;};this.init=function(){var o=this.options,win=this.window,preview=this.preview,i,p;width=o.width>0?parseInt(o.width):450;height=o.height>0?parseInt(o.height):300;fm.one("load",function(){parent=fm.getUI();cwd=fm.getUI("cwd");win.appendTo("body").zIndex(100+parent.zIndex());$(document).keydown(function(e){e.keyCode==27&&self.opened()&&win.trigger("close");});if($.fn.resizable){win.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){preview.trigger("changesize");}});}self.change(function(){if(self.opened()){self.value?preview.trigger($.Event("update",{file:self.value})):win.trigger("close");}});$.each(fm.commands.quicklook.plugins||[],function(i,plugin){if(typeof(plugin)=="function"){new plugin(self);}});preview.bind("update",function(){self.info.show();});});};this.getstate=function(){return this.fm.selected().length==1?state==opened?1:0:-1;};this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open");};this.hideinfo=function(){this.info.stop(true).hide();};};elFinder.prototype.commands.quicklook.plugins=[function(ql){var mimes=["image/jpeg","image/png","image/gif"],preview=ql.preview;$.each(navigator.mimeTypes,function(i,o){var mime=o.type;if(mime.indexOf("image/")===0&&$.inArray(mime,mimes)){mimes.push(mime);}});preview.bind("update",function(e){var file=e.file,img;if($.inArray(file.mime,mimes)!==-1){e.stopImmediatePropagation();img=$("<img/>").hide().appendTo(preview).load(function(){setTimeout(function(){var prop=(img.width()/img.height()).toFixed(2);preview.bind("changesize",function(){var pw=parseInt(preview.width()),ph=parseInt(preview.height()),w,h;if(prop<(pw/ph).toFixed(2)){h=ph;w=Math.floor(h*prop);}else{w=pw;h=Math.floor(w/prop);}img.width(w).height(h).css("margin-top",h<ph?Math.floor((ph-h)/2):0);}).trigger("changesize");ql.hideinfo();img.fadeIn(100);},1);}).attr("src",ql.fm.url(file.hash));}});},function(ql){var mimes=["text/html","application/xhtml+xml"],preview=ql.preview,fm=ql.fm;preview.bind("update",function(e){var file=e.file,jqxhr;if($.inArray(file.mime,mimes)!==-1){e.stopImmediatePropagation();preview.one("change",function(){jqxhr.state()=="pending"&&jqxhr.reject();});jqxhr=fm.request({data:{cmd:"get",target:file.hash,current:file.phash},preventDefault:true}).done(function(data){ql.hideinfo();doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(preview)[0].contentWindow.document;doc.open();doc.write(data.content);doc.close();});}});},function(ql){var fm=ql.fm,mimes=fm.res("mimes","text"),preview=ql.preview;preview.bind("update",function(e){var file=e.file,mime=file.mime,jqxhr;if(mime.indexOf("text/")===0||$.inArray(mime,mimes)!==-1){e.stopImmediatePropagation();preview.one("change",function(){jqxhr.state()=="pending"&&jqxhr.reject();});jqxhr=fm.request({data:{cmd:"get",target:file.hash},preventDefault:true}).done(function(data){ql.hideinfo();$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+fm.escape(data.content)+"</pre></div>").appendTo(preview);});}});},function(ql){var fm=ql.fm,mime="application/pdf",preview=ql.preview,active=false;if((fm.UA.Safari&&fm.OS=="mac")||fm.UA.IE){active=true;}else{$.each(navigator.plugins,function(i,plugins){$.each(plugins,function(i,plugin){if(plugin.type==mime){return !(active=true);}});});}active&&preview.bind("update",function(e){var file=e.file,node;if(file.mime==mime){e.stopImmediatePropagation();preview.one("change",function(){node.unbind("load").remove();});node=$('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(preview).load(function(){ql.hideinfo();node.show();}).attr("src",fm.url(file.hash));}});},function(ql){var fm=ql.fm,mime="application/x-shockwave-flash",preview=ql.preview,active=false;$.each(navigator.plugins,function(i,plugins){$.each(plugins,function(i,plugin){if(plugin.type==mime){return !(active=true);}});});active&&preview.bind("update",function(e){var file=e.file,node;if(file.mime==mime){e.stopImmediatePropagation();ql.hideinfo();preview.append((node=$('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+fm.url(file.hash)+'" quality="high" type="application/x-shockwave-flash" />')));}});},function(ql){var preview=ql.preview,autoplay=!!ql.options.autoplay,mimes={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},node;preview.bind("update",function(e){var file=e.file,type=mimes[file.mime];if(ql.support.audio[type]){e.stopImmediatePropagation();node=$('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+ql.fm.url(file.hash)+'" /></audio>').appendTo(preview);autoplay&&node[0].play();}}).bind("change",function(){if(node&&node.parent().length){node[0].pause();node.remove();node=null;}});},function(ql){var preview=ql.preview,autoplay=!!ql.options.autoplay,mimes={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},node;preview.bind("update",function(e){var file=e.file,type=mimes[file.mime];if(ql.support.video[type]){e.stopImmediatePropagation();ql.hideinfo();node=$('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+ql.fm.url(file.hash)+'" /></video>').appendTo(preview);autoplay&&node[0].play();}}).bind("change",function(){if(node&&node.parent().length){node[0].pause();node.remove();node=null;}});},function(ql){var preview=ql.preview,mimes=[],node;$.each(navigator.plugins,function(i,plugins){$.each(plugins,function(i,plugin){(plugin.type.indexOf("audio/")===0||plugin.type.indexOf("video/")===0)&&mimes.push(plugin.type);});});preview.bind("update",function(e){var file=e.file,mime=file.mime,video;if($.inArray(file.mime,mimes)!==-1){e.stopImmediatePropagation();(video=mime.indexOf("video/")===0)&&ql.hideinfo();node=$('<embed src="'+ql.fm.url(file.hash)+'" type="'+mime+'" class="elfinder-quicklook-preview-'+(video?"video":"audio")+'"/>').appendTo(preview);}}).bind("change",function(){if(node&&node.parent().length){node.remove();node=null;}});}];"use strict";elFinder.prototype.commands.view=function(){this.value=this.fm.viewType;this.alwaysEnabled=true;this.updateOnSelect=false;this.options={ui:"viewbutton"};this.getstate=function(){return 0;};this.exec=function(){var value=this.fm.storage("view",this.value=="list"?"icons":"list");this.fm.viewchange();this.update(void (0),value);};};"use strict";elFinder.prototype.commands.sort=function(){this.options={ui:"sortbutton"};this.getstate=function(){return 0;};this.exec=function(hashes,sort){var fm=this.fm,sort=$.extend({type:fm.sortType,order:fm.sortOrder,stick:fm.sortStickFolders},sort);this.fm.setSort(sort.type,sort.order,sort.stick);return $.Deferred().resolve();};};